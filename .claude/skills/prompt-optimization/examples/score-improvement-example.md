# スコア改善の実例集

このドキュメントは、各評価軸のスコアを改善する具体的な手法と実例を示します。

---

## 明確性の改善（Clarity）

### パターン1: 曖昧な表現を具体化

#### Before（スコア: 4/10）
```markdown
コードを適切にレビューしてください。
```

**問題点**:
- "適切に"が曖昧
- レビュー観点が不明
- 期待される出力が不明

#### After（スコア: 9/10）
```markdown
以下の3つの観点でコードをレビューしてください：

1. **セキュリティ**:
   - XSS脆弱性の有無
   - SQLインジェクションのリスク
   - CSRF対策の実装

2. **パフォーマンス**:
   - O(n²)以上のアルゴリズムの特定
   - 不要なループやネストの指摘
   - メモリリークの可能性

3. **可読性**:
   - 変数名の明確さ（最低3文字）
   - コメント比率20%以上
   - 関数の長さ（最大50行）

各観点で問題があれば、具体的な行番号と改善案を提示してください。
```

**改善効果**: +5点

---

### パターン2: 専門用語の定義

#### Before（スコア: 5/10）
```markdown
DRY原則に従ってリファクタリングしてください。
```

**問題点**:
- "DRY"が未定義（初心者は知らない可能性）

#### After（スコア: 9/10）
```markdown
DRY原則（Don't Repeat Yourself - 同じコードを繰り返さない）に従ってリファクタリングしてください。

**具体的には**:
- 重複するコードブロック（3行以上）を関数化
- 類似するロジックを共通化
- マジックナンバーを定数化

**例**:
```typescript
// ❌ Before: 重複あり
function calculateTaxA(price: number) { return price * 1.1; }
function calculateTaxB(price: number) { return price * 1.1; }

// ✅ After: DRY原則適用
const TAX_RATE = 1.1;
function calculateTax(price: number) { return price * TAX_RATE; }
```
```

**改善効果**: +4点

---

### パターン3: 判断基準の明示

#### Before（スコア: 6/10）
```markdown
高品質なコードを書いてください。
```

**問題点**:
- "高品質"の基準が不明

#### After（スコア: 9/10）
```markdown
以下の基準を満たすコードを書いてください：

**品質基準**:
| 項目 | 基準 | 測定方法 |
|------|------|---------|
| テストカバレッジ | 80%以上 | Jest coverage |
| TypeScript厳格性 | strict mode | tsconfig.json |
| ESLint警告 | 0件 | eslint --max-warnings 0 |
| 関数の長さ | 最大50行 | 目視確認 |
| 循環的複雑度 | 10以下 | ESLintプラグイン |

**チェック方法**:
\`\`\`bash
npm run test:coverage  # カバレッジ確認
npm run lint           # ESLint実行
npm run type-check     # TypeScriptチェック
\`\`\`
```

**改善効果**: +3点

---

## 完全性の改善（Completeness）

### パターン1: 必須要素の明示

#### Before（スコア: 3/10）
```markdown
APIエンドポイントを実装してください。
```

**問題点**:
- 何を実装すべきか不明
- エラー処理、認証、バリデーションの指示なし

#### After（スコア: 9/10）
```markdown
## APIエンドポイント実装

### 必須要素

#### 1. エンドポイント定義
\`\`\`typescript
// src/api/users.ts
GET    /api/users       # 全ユーザー取得
GET    /api/users/:id   # 特定ユーザー取得
POST   /api/users       # ユーザー作成
PUT    /api/users/:id   # ユーザー更新
DELETE /api/users/:id   # ユーザー削除
\`\`\`

#### 2. 認証
- すべてのエンドポイントでJWT認証必須
- `Authorization: Bearer <token>` ヘッダーを検証

#### 3. バリデーション
- リクエストボディをZodで検証
- エラー時は400を返却

#### 4. エラーハンドリング
- 400: バリデーションエラー
- 401: 認証エラー
- 404: リソースが存在しない
- 500: サーバーエラー

#### 5. レスポンス形式
\`\`\`typescript
// 成功時
{ success: true, data: T }

// エラー時
{ success: false, error: string }
\`\`\`

#### 6. テスト
- 正常系: 各エンドポイントの基本動作
- 異常系: 認証失敗、バリデーション失敗
- カバレッジ: 80%以上

### チェックリスト
- [ ] すべてのエンドポイントを実装
- [ ] JWT認証を実装
- [ ] Zodバリデーションを実装
- [ ] エラーハンドリングを実装
- [ ] テストを実装（カバレッジ80%以上）
```

**改善効果**: +6点

---

### パターン2: 例外ケースの考慮

#### Before（スコア: 5/10）
```markdown
ユーザー登録機能を実装してください。
```

**問題点**:
- 重複メール、不正な入力などの例外ケースが考慮されていない

#### After（スコア: 9/10）
```markdown
## ユーザー登録機能

### 正常系
1. メールとパスワードを受け取る
2. パスワードをハッシュ化
3. データベースに保存
4. 確認メールを送信

### 例外ケース

#### ケース1: メールアドレス重複
**条件**: 既に登録済みのメール
**処理**: 409 Conflictを返却
**メッセージ**: "このメールアドレスは既に登録されています"

#### ケース2: パスワード要件違反
**条件**: 8文字未満、または英数字記号を含まない
**処理**: 400 Bad Requestを返却
**メッセージ**: "パスワードは8文字以上で、英数字と記号を含む必要があります"

#### ケース3: メール送信失敗
**条件**: SMTPサーバーエラー
**処理**: ユーザー作成は成功、エラーログ記録
**対応**: バックグラウンドジョブで再送

#### ケース4: データベース接続エラー
**条件**: DBサーバーダウン
**処理**: 500 Internal Server Errorを返却
**対応**: エラーを監視サービスに通知

### 実装チェックリスト
- [ ] 正常系の実装
- [ ] メール重複チェック
- [ ] パスワードバリデーション
- [ ] メール送信のエラーハンドリング
- [ ] DB接続エラーのハンドリング
- [ ] すべてのケースのテスト
```

**改善効果**: +4点

---

## 構造性の改善（Structure）

### パターン1: 段階的な指示への再構築

#### Before（スコア: 3/10）
```markdown
プロジェクトをセットアップし、認証機能を実装し、テストを書いてください。
```

**問題点**:
- ステップが不明確
- 論理的な順序がない

#### After（スコア: 9/10）
```markdown
## プロジェクトセットアップと認証実装

### フェーズ1: プロジェクト初期化（15分）

#### ステップ1.1: Next.jsプロジェクト作成
\`\`\`bash
npx create-next-app@latest my-app --typescript --tailwind --app
cd my-app
\`\`\`

#### ステップ1.2: 必要なパッケージインストール
\`\`\`bash
npm install @clerk/nextjs
npm install -D @types/node
\`\`\`

#### ステップ1.3: 環境変数設定
\`.env.local\` を作成：
\`\`\`
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_xxx
CLERK_SECRET_KEY=sk_test_xxx
\`\`\`

### フェーズ2: 認証機能実装（30分）

#### ステップ2.1: ClerkProviderの設定
\`src/app/layout.tsx\` を編集
[実装コード]

#### ステップ2.2: ミドルウェア設定
\`src/middleware.ts\` を作成
[実装コード]

#### ステップ2.3: 認証UI追加
\`src/app/sign-in/page.tsx\` を作成
[実装コード]

### フェーズ3: テスト実装（20分）

#### ステップ3.1: テスト環境設定
\`jest.config.js\` を作成
[設定コード]

#### ステップ3.2: 認証フローのテスト
\`__tests__/auth.test.ts\` を作成
[テストコード]

#### ステップ3.3: テスト実行と確認
\`\`\`bash
npm run test
# カバレッジ80%以上を確認
\`\`\`

### 完了確認チェックリスト
- [ ] フェーズ1完了（プロジェクト初期化）
- [ ] フェーズ2完了（認証機能実装）
- [ ] フェーズ3完了（テスト実装）
- [ ] すべてのテストが合格
- [ ] カバレッジ80%以上
```

**改善効果**: +6点

---

### パターン2: 視覚的な区切りの追加

#### Before（スコア: 6/10）
```markdown
まずデータベース設計をします。次にAPIを実装します。最後にフロントエンドを作ります。
```

**問題点**:
- 視覚的な区切りがない
- 読みにくい

#### After（スコア: 9/10）
```markdown
## 開発プロセス

---

### 📊 ステップ1: データベース設計

**所要時間**: 30分

#### 1.1 テーブル設計
[設計内容]

#### 1.2 RLS ポリシー設定
[ポリシー内容]

---

### ⚙️ ステップ2: API実装

**所要時間**: 45分

#### 2.1 エンドポイント定義
[エンドポイント]

#### 2.2 ビジネスロジック実装
[実装内容]

---

### 🎨 ステップ3: フロントエンド実装

**所要時間**: 60分

#### 3.1 コンポーネント設計
[コンポーネント]

#### 3.2 状態管理
[状態管理]

---

### ✅ 最終確認

[チェックリスト]
```

**改善効果**: +3点

---

## 例示性の改善（Examples）

### パターン1: 良い例・悪い例の追加

#### Before（スコア: 2/10）
```markdown
適切なコミットメッセージを書いてください。
```

**問題点**:
- 例が全くない

#### After（スコア: 9/10）
```markdown
## コミットメッセージの書き方

### ✅ 良い例

#### 例1: 機能追加
\`\`\`
feat: ユーザープロフィール編集機能を追加

- プロフィール画像のアップロード
- 名前・自己紹介の編集
- バリデーションとエラー表示

Closes #123
\`\`\`
**なぜ良い**: プレフィックス明確、概要簡潔、詳細は箇条書き、issue番号

#### 例2: バグ修正
\`\`\`
fix: ログアウト時のメモリリークを修正

useEffect のクリーンアップ関数でイベントリスナーを削除。
\`\`\`
**なぜ良い**: 問題と解決策が明確

#### 例3: リファクタリング
\`\`\`
refactor: API呼び出しをカスタムフックに抽出

useApiCall フックを作成し、以下を統一:
- エラーハンドリング
- ローディング状態管理
- リトライロジック
\`\`\`
**なぜ良い**: 目的と具体的な改善点が明確

### ❌ 悪い例

#### 例1: 不明瞭
\`\`\`
update
\`\`\`
**なぜダメ**: 何を更新したか全く不明

#### 例2: 詳細すぎ
\`\`\`
ログインボタンの色を#3B82F6から#2563EBに変更し、
ホバー時にopacity: 0.9を適用し、
フォントサイズを14pxから16pxに変更し、
パディングを8pxから12pxに変更...
\`\`\`
**なぜダメ**: 実装の詳細すぎ、概要が不明

### 💡 実践例（完全なワークフロー）
\`\`\`bash
# 1. 変更を確認
git status
git diff

# 2. ステージング
git add src/components/Profile.tsx
git add src/hooks/useProfile.ts

# 3. コミット
git commit -m "feat: プロフィール編集機能を追加

- プロフィール画像のアップロード
- 名前・自己紹介の編集
- バリデーションとエラー表示

Closes #123"

# 4. プッシュ
git push origin feature/profile-edit
\`\`\`
```

**改善効果**: +7点

---

## 実行可能性の改善（Actionability）

### パターン1: 抽象的な指示を具体化

#### Before（スコア: 4/10）
```markdown
品質を確認してください。
```

**問題点**:
- 何をどう確認するか不明

#### After（スコア: 9/10）
```markdown
## 品質確認手順

### ステップ1: 自動チェック（5分）

\`\`\`bash
# TypeScriptエラーチェック
npm run type-check
# 期待: "0 errors"

# ESLintチェック
npm run lint
# 期待: "0 warnings, 0 errors"

# テスト実行
npm run test
# 期待: "All tests passed"

# カバレッジ確認
npm run test:coverage
# 期待: ">= 80%"
\`\`\`

### ステップ2: 手動チェック（10分）

#### 2.1 コードレビュー
- [ ] 変数名が明確（最低3文字）
- [ ] 関数が50行以内
- [ ] コメント比率20%以上
- [ ] マジックナンバーなし

#### 2.2 セキュリティチェック
- [ ] 環境変数を使用（ハードコードなし）
- [ ] ユーザー入力をサニタイズ
- [ ] SQLインジェクション対策
- [ ] XSS対策

### ステップ3: 結果記録（2分）

\`\`\`markdown
## 品質チェック結果

**日付**: YYYY-MM-DD
**チェック者**: [名前]

### 自動チェック
- TypeScript: ✅ 0 errors
- ESLint: ✅ 0 warnings
- Tests: ✅ All passed
- Coverage: ✅ 85%

### 手動チェック
- コードレビュー: ✅ 合格
- セキュリティ: ⚠️ 要改善（詳細: [issue番号]）

### 総合評価: 良好
\`\`\`
```

**改善効果**: +5点

---

### パターン2: チェックリストの追加

#### Before（スコア: 6/10）
```markdown
デプロイ前に確認してください。
```

**問題点**:
- 何を確認すべきか不明

#### After（スコア: 10/10）
```markdown
## デプロイ前チェックリスト

### フェーズ1: ローカル確認

#### コード品質
- [ ] すべてのテストが合格
- [ ] TypeScriptエラー0件
- [ ] ESLint警告0件
- [ ] カバレッジ80%以上

#### ビルド確認
- [ ] `npm run build` が成功
- [ ] ビルドサイズが10MB以下
- [ ] 警告メッセージなし

### フェーズ2: 環境変数確認

#### 本番環境変数
- [ ] `DATABASE_URL` 設定済み
- [ ] `NEXT_PUBLIC_API_URL` 設定済み
- [ ] `CLERK_SECRET_KEY` 設定済み
- [ ] 開発用の値が含まれていない

### フェーズ3: セキュリティ確認

#### セキュリティチェック
- [ ] API キーがコードに含まれていない
- [ ] `.env` ファイルが `.gitignore` に含まれる
- [ ] HTTPS を使用
- [ ] CORS 設定が適切

### フェーズ4: パフォーマンス確認

#### Lighthouse スコア
- [ ] Performance: 90以上
- [ ] Accessibility: 90以上
- [ ] Best Practices: 90以上
- [ ] SEO: 90以上

### フェーズ5: 最終確認

#### デプロイ準備
- [ ] README.md を更新
- [ ] CHANGELOG.md を更新
- [ ] バージョン番号を更新（package.json）
- [ ] Git タグを作成

#### デプロイ実行
\`\`\`bash
# Vercelにデプロイ
vercel --prod

# デプロイ成功を確認
# URL: https://your-app.vercel.app
\`\`\`

#### デプロイ後確認
- [ ] 本番サイトが正常に表示される
- [ ] すべての機能が動作する
- [ ] エラーログにエラーがない
- [ ] パフォーマンスが許容範囲
```

**改善効果**: +4点

---

## 総合的な改善例

### Before（スコア: 20/50）

```markdown
Webアプリを作ってください。
```

### After（スコア: 47/50）

```markdown
# Webアプリ開発プロジェクト

## 📋 プロジェクト概要

**目的**: ユーザー認証機能を持つタスク管理Webアプリを開発

**技術スタック**:
- Next.js 14 (App Router)
- TypeScript
- Supabase (DB + Auth)
- Tailwind CSS
- Jest + React Testing Library

---

## 🎯 開発フェーズ

### フェーズ1: プロジェクト初期化（30分）

#### 1.1 Next.jsプロジェクト作成
[詳細手順]

#### 1.2 依存関係インストール
[パッケージリスト]

#### 1.3 環境変数設定
[設定内容]

### フェーズ2: データベース設計（45分）

#### 2.1 テーブル設計
[ERD図とSQL]

#### 2.2 RLSポリシー設定
[ポリシー詳細]

### フェーズ3: 認証実装（60分）

#### 3.1 Clerk統合
[実装手順]

#### 3.2 認証フロー実装
[コード例]

### フェーズ4: タスク機能実装（120分）

#### 4.1 CRUD操作
[実装手順]

#### 4.2 UI実装
[コンポーネント設計]

### フェーズ5: テストと品質確認（60分)

#### 5.1 ユニットテスト
[テストケース]

#### 5.2 E2Eテスト
[シナリオ]

### フェーズ6: デプロイ（30分）

#### 6.1 Vercelデプロイ
[手順]

---

## ✅ 品質基準

### コード品質
- テストカバレッジ: 80%以上
- TypeScript: strict mode
- ESLint: 0 warnings

### パフォーマンス
- Lighthouse Performance: 90以上
- 初回ロード時間: 3秒以内

### セキュリティ
- すべてのAPIエンドポイントで認証
- ユーザー入力のサニタイズ
- 環境変数で機密情報管理

---

## 📚 参考資料

### 良い実装例
[コード例1: 認証フロー]
[コード例2: CRUD操作]
[コード例3: エラーハンドリング]

### 悪い実装例（避けるべき）
[アンチパターン1]
[アンチパターン2]

---

## 🔍 チェックリスト

### 開発完了チェック
- [ ] すべてのフェーズ完了
- [ ] すべてのテスト合格
- [ ] 品質基準を満たす
- [ ] デプロイ成功
- [ ] 本番環境で動作確認
```

**改善内訳**:
- 明確性: 3 → 9 (+6)
- 完全性: 2 → 9 (+7)
- 構造性: 3 → 10 (+7)
- 例示性: 4 → 9 (+5)
- 実行可能性: 8 → 10 (+2)
**合計**: 20 → 47 (+27点、135%改善)

---

**戻る**: [SKILL.md](../SKILL.md)

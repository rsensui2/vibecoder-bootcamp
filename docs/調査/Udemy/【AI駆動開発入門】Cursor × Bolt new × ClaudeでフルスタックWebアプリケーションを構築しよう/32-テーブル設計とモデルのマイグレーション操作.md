# 32. テーブル設計とモデルのマイグレーション操作

ということで、データベース設計したものをテーブルに反映させていきたいと思います。

まず、PRISMAスキーマとPRISMAファイルを開いてください。

今、適当にユーザーモデルが入っているかなと思います。

皆さんのコンポーザーの吐き出し方次第ではちょっと違うかもしれないんですけども、実際に要件定義というか、詳細設計した際のモデルを追加し

ていきたいと思います。

書き換えていきますね。

ということで、農村の方の要件定義書を開いていただいて、こちらですね、ここをコピーしていきます。

INDEXとあるんですけど、ここまでコピーしておきましょうか。

はい。

制約事項とかもありますので、将来的な拡張性とかもありますね。

ここら辺も全部持っていきましょうか。

せっかくなので、ここら辺全部コピーしてあげて、そしてここに貼り付けてください。

コンポーザーに貼り付けていきます。

これを元にアットマークのシンボル、シンボル機能を使っていきましょうか。

スキーマファイルですね。

ちょっと見づらくなっちゃったんですけども。

SKINはPRISMAちょっと見づらいですけどね。

SKINを修正してくださいというふうに尋ねていきましょう。

いい感じですね。

まあ、ちょっとここ重要なので、一つ一つ確認していきたいと思います。

まずUSERMODELですね。

USERモデルはPROFILEIMAGEURLとなるほどだと。

カバー画像のカバー画像もね、あるんですけど、カバー画像っていうのはプロフィールページの後ろ側ですね。

これも必要ではあるんですけど、これも追加してもいいかもしれませんね。

まあ、とりあえず承認しておきましょう。

他にもリレーションはPOSTLIKEFOLLOWとFOLLOWING、外部キー制約も外部キー接続もちゃんとできている訳ですね。

はい、承認します。

POSTはPOST内容とリレーション内容で返信機能も付けれてますよということですね。

はい、いいと思います。

ちゃんとINDEXもつけてます。

で、FOLLOWに関しても全部できているわけですね。

FOLLOWっていうのはどうやって数をカウントするのかっていうと、フォローイングとかフォロワーの配列ですね。

配列の長さを見ればフォロワー数っていうのはカウントできるわけですね。

AFTERLIKEに関しても同様かなと思います。

ということで、このままマイグレーションしてもいいかなと思います。

で、よくわからないという方は、実際にコンポーザーが言ってくれてるんじゃないかなという形ですね。

で、このスキーマを適用するには、以下のコマンドですと、ちょっと外部、これ設計がわからなかった方はコンポーザーもしくはチャットですね、コントロール

のチャット機能で説明してくださいとかですね、これについて説明してくださいというふうにすると具体的に教えてくれます。

一応、カバー画像についても聞いておきましょうか。

カバー画像をプロフィールにつける場合は？

というふうにちょっと聞いてみましょう。

はい、そうすると上のほうにカバーIMAGEURLが追加されます。

まあ、一応追加しておきましょうか。

そしてマイグレーション操作をしたいので上に戻ってあげてこれですかね。

PRISMAジェネレートということで、ちょっとターミナルで実行していきましょうか。

はい、これを貼り付けて実行していきます。

ジェネレートできましたね。

続いてDBプッシュかな。

ちょっとできるかどうかわからないんですけど、ちょっとやっていきましょう。

そうするとちょっと時間かかりますので、しばらくお待ちください。

ちょっとスパベースのテーブルの方、確認していきましょうか。

ベーステーブルでちょっとリロードしてみますね。

リロードするとまだ反映はされてないですかね。

まだ反映されてませんね。

遅いな。

ちょっと結構待ってるんですけど、なかなかプッシュしてくれないので。

マイグレーションはじめてのマイグレーション操作だとこのコマンドで合ってるんでしょうかね？

マイグレーションしてくださいね。

初めてのモデルのマイグレーションの場合はDBプッシュでいいの？

というふうにちょっと聞いてみます。

PRISMAマイグレートを使用するべきです。

というふうに。

まあ、嘘嘘でしたね、はい、すいません。

ということで、コントロールキーでちょっと一回止めましょう。

コントロールキーで止めてあげて。

これですね。

マイグレートネームユニット。

そうですよね。

はい、これでちょっと見ていきます。

そうするとうまくいくのかなという形ですね。

これはREJECTで大丈夫です。

DBプッシュは何の役割なんですかね。

開発初期はプロトタイピング時のみ使用ということで、基本的に使わないんじゃないかなと思いますね。

複数人の開発ではマイグレートですよね。

はい。

ということで、ちょっと待っていただくと、なかなか反映はされないんですけど、リロードしてみましょうか。

まだ反映されてないですね。

ここにマイグレーションっていうファイルが作成されると思います。

いっとき待っとけばね、たまにこうやって待ってもね、全然マイグレーションしてくれない時もありますので、ちょっとその場合はね、一回止め

ます。

一回止めて何回かやり直すといいんじゃないかなと思います。

ちょっと遅すぎるので聞いてみましょうか。

ここでずっと止まっていますというふうにちょっと聞いてみます。

直接変更しますってあるんですけど、これもしなくていいんですけどね。

ポートを変更する6543になってるのを変更点ちょっと待って下さいね。

全部ファイルを確認するんですけど。

そうですね、もしかするとこの6543のプーラーのデータベースの指定が良くないみたいなので、ちょっとこれも修正していきましょうか。

これをして終わりにしたいと思います。

指定ののが間違ったかな。

データベースデータAPIでじゃなくて、どれだったかな。

CONNECTのパスワードの543人か。

トランザクションアクションプーラーTRANSACTIONプーラーだとちょっとうまくいかなかったみたいなので、ダイレクトコネクションというものをコピーして

いきましょうか。

はい、すいません。

僕のミスだったかもしれませんね。

ここをダイレクトURLに変更して、で、パスワードもここに置き換えて、このような形だとうまくいくかもですね。

ちょっともう一度マイグレーションしていきますね。

すいません、行きましたね。

私のコピー先が。

私のコピー元が間違っていたみたいです。

申し訳ございません。

トランザクションの方ではなくて、ダイレクトのURLの方を貼り付けていただくと、このような形でマイグレーションのファイルが作成されますという

ことですね。

はい。

そしてテーブルの方を確認してみますね。

テーブルエディター見てみると、おそらくちゃんと追加されました。

ユーザーズとPOSTといろいろありますね。

いいと思います。

すいませんでした。

じゃあ続いての動画はね、まだデータが何も入っていないので、ちょっとね、ダミーデータを入れていこうかなと思っております。

シードと言われているデータ入れられるならば入れていきますということで、ついでの動画でお会いしましょう。

バイバイ。

自動スクロール

## コースの内容

## 概要

## Q&A質問と回答

## メモ

## お知らせ

## レビュー

## 学習ツール

-

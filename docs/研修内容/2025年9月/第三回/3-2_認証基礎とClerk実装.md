---
marp: true
theme: default
paginate: true
---

# **ç¬¬ä¸‰å› Session 2**
## èªè¨¼ãƒ»èªå¯åŸºç¤ã¨Clerkå®Ÿè£…

**ï½AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ™‚ä»£ã®ã€Œä¿¡é ¼ã€ã‚’æ§‹ç¯‰ã™ã‚‹ï½**

**Vibe Coder Bootcamp**
**2025å¹´9æœˆç‰ˆ**

---

# æœ¬æ—¥ã®ã‚¢ã‚¸ã‚§ãƒ³ãƒ€ (75åˆ†é–“)

1. **èªè¨¼ãƒ»èªå¯ã®åŸºç¤çŸ¥è­˜ (20åˆ†)**
   - èªè¨¼ã¨èªå¯ã®é•ã„ï¼šã€Œèº«å…ƒç¢ºèªã€ã¨ã€Œæ¨©é™ç®¡ç†ã€
   - ãªãœèªè¨¼ã‚’è‡ªä½œã—ã¦ã¯ã„ã‘ãªã„ã®ã‹ï¼Ÿ
   - ç¾ä»£èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®è¦ä»¶ã¨ãƒˆãƒ¬ãƒ³ãƒ‰

2. **Clerkæ¦‚è«–ã¨Googleèªè¨¼è¨­å®š (25åˆ†)**
   - ClerkãŒã‚‚ãŸã‚‰ã™UXé©å‘½
   - 2025å¹´æœ€æ–°ï¼šé–‹ç™ºç’°å¢ƒã§ã®ç°¡å˜è¨­å®š
   - OAuth 2.0ãƒ•ãƒ­ãƒ¼ã®ç†è§£

3. **AIã§èªè¨¼å®Ÿè£…ï¼ˆå®Œå…¨ç†è§£ç‰ˆï¼‰(25åˆ†)**
   - Clerk AI Promptsã§5åˆ†å®Ÿè£…
   - ç”¨èªã¨è¨­å®šé …ç›®ã®å®Œå…¨ç†è§£
   - ã‚¨ãƒ©ãƒ¼å¯¾å‡¦ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

4. **Clerk + Supabaseé€£æºã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ (5åˆ†)**
   - JWTé€£æºã®ä»•çµ„ã¿
   - RLSï¼ˆRow Level Securityï¼‰ã¨ã®çµ±åˆ

---

# ğŸ¯ ä»Šæ—¥ã®å­¦ç¿’ç›®æ¨™

## æŠ€è¡“çš„ã‚´ãƒ¼ãƒ«
- èªè¨¼ã¨èªå¯ã®æ¦‚å¿µã‚’å®Œå…¨ç†è§£
- Clerkã«ã‚ˆã‚‹ã€Œè¶…ã€ç°¡å˜èªè¨¼å®Ÿè£…
- ç¾ä»£çš„ãªJWTèªè¨¼ãƒ•ãƒ­ãƒ¼ã®ç¿’å¾—

## ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤
- ãªãœå¤šãã®ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ãŒèªè¨¼ã§å¤±æ•—ã™ã‚‹ã®ã‹ã‚’ç†è§£
- AIæ™‚ä»£ã«å¯¾å¿œã—ãŸã€Œã‚¼ãƒ­ãƒˆãƒ©ã‚¹ãƒˆèªè¨¼ã€ã®åŸºç¤ç¿’å¾—
- æ˜æ—¥ã‹ã‚‰ä½¿ãˆã‚‹Clerkå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’èº«ã«ã¤ã‘ã‚‹

## å®Ÿå‹™ã¸ã®å¿œç”¨
- ã‚»ã‚­ãƒ¥ã‚¢ãªWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­è¨ˆèƒ½åŠ›
- èªè¨¼ã‚³ã‚¹ãƒˆã‚’90%å‰Šæ¸›ã™ã‚‹æ–¹æ³•ã®ç¿’å¾—
- ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ¬ãƒ™ãƒ«ã®èªè¨¼ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰ã‚¹ã‚­ãƒ«

---

# ãƒ‘ãƒ¼ãƒˆ1ï¼šèªè¨¼ãƒ»èªå¯ã®åŸºç¤çŸ¥è­˜
## 20åˆ†

---

# ğŸ”’ èªè¨¼ãƒ»èªå¯ã®åŸºç¤çŸ¥è­˜

## ã¾ãšæœ€åˆã«ç†è§£ã™ã¹ã2ã¤ã®æ¦‚å¿µ

**èªè¨¼ï¼ˆAuthenticationï¼‰ã¨èªå¯ï¼ˆAuthorizationï¼‰**

ã“ã®2ã¤ã®é•ã„ã‚’ç†è§£ã™ã‚‹ã“ã¨ãŒã€
ã‚»ã‚­ãƒ¥ã‚¢ãªã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆã®ç¬¬ä¸€æ­©ã§ã™

---

# èªè¨¼ (Authentication) ã¨ã¯ï¼Ÿ

## ã€Œã‚ãªãŸã¯èª°ï¼Ÿã€ã‚’ç¢ºèªã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹

### æ—¥å¸¸ç”Ÿæ´»ã§ã®ä¾‹
- **ç©ºæ¸¯ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯**: ãƒ‘ã‚¹ãƒãƒ¼ãƒˆã§æœ¬äººç¢ºèª
- **éŠ€è¡ŒATM**: æš—è¨¼ç•ªå·ã§ã‚«ãƒ¼ãƒ‰æ‰€æœ‰è€…ã‚’ç¢ºèª
- **ãƒãƒ³ã‚·ãƒ§ãƒ³å…¥å£**: ã‚ªãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã§ã®ä½æ°‘ç¢ºèª

### ãƒ‡ã‚¸ã‚¿ãƒ«ä¸–ç•Œã§ã®ä¾‹
- **ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ + ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**
- **æŒ‡ç´‹èªè¨¼ã€é¡”èªè¨¼**
- **SMSèªè¨¼ã‚³ãƒ¼ãƒ‰**
- **ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆGoogleã€Facebookï¼‰**

---

# èªå¯ (Authorization) ã¨ã¯ï¼Ÿ

## ã€Œã‚ãªãŸã«ä½•ãŒã§ãã‚‹ï¼Ÿã€ã‚’ç®¡ç†ã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹

### æ—¥å¸¸ç”Ÿæ´»ã§ã®ä¾‹
- **ãƒ›ãƒ†ãƒ«ã®ã‚«ãƒ¼ãƒ‰ã‚­ãƒ¼**: è‡ªåˆ†ã®éƒ¨å±‹ã ã‘é–‹ã‘ã‚‰ã‚Œã‚‹
- **ä¼šç¤¾ã®ç¤¾å“¡è¨¼**: å…¥ã‚Œã‚‹ãƒ•ãƒ­ã‚¢ãŒåˆ¶é™ã•ã‚Œã¦ã„ã‚‹
- **é§è»Šå ´ã®å¥‘ç´„**: å¥‘ç´„è€…å°‚ç”¨ã‚¹ãƒšãƒ¼ã‚¹ã®åˆ©ç”¨æ¨©é™

### ãƒ‡ã‚¸ã‚¿ãƒ«ä¸–ç•Œã§ã®ä¾‹
- **ç®¡ç†è€… vs ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼**: å‰Šé™¤æ¨©é™ã®æœ‰ç„¡
- **æœ‰æ–™ä¼šå“¡ vs ç„¡æ–™ä¼šå“¡**: ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹
- **éƒ¨ç½²åˆ¥ã‚¢ã‚¯ã‚»ã‚¹**: çµŒç†ãƒ‡ãƒ¼ã‚¿ã¯çµŒç†éƒ¨ã®ã¿é–²è¦§å¯èƒ½

---

# èªè¨¼ã¨èªå¯ï¼šãƒãƒ³ã‚·ãƒ§ãƒ³ã®æ¯”å–©ã§å®Œå…¨ç†è§£

```mermaid
graph TB
    subgraph "èªè¨¼ (Authentication)"
        A[è¨ªå•è€…] -->|ä½æ°‘ã‚«ãƒ¼ãƒ‰æç¤º| B[ã‚¨ãƒ³ãƒˆãƒ©ãƒ³ã‚¹]
        B -->|æœ¬äººç¢ºèªOK| C[ãƒãƒ³ã‚·ãƒ§ãƒ³å†…ã«å…¥ã‚Œã‚‹]
        B -->|æœ¬äººç¢ºèªNG| D[å…¥ã‚Œãªã„]
    end

    subgraph "èªå¯ (Authorization)"
        C -->|è‡ªåˆ†ã®éƒ¨å±‹| E[âœ… é–‹ã‘ã‚‰ã‚Œã‚‹]
        C -->|ä»–äººã®éƒ¨å±‹| F[âŒ é–‹ã‘ã‚‰ã‚Œãªã„]
        C -->|å…±ç”¨ã‚¸ãƒ | G[å¥‘ç´„ã«ã‚ˆã‚Šç•°ãªã‚‹]
        C -->|å±‹ä¸Š| H[ä½æ°‘å…¨å“¡OK]
    end
```

**èªè¨¼ = å…¥é¤¨è¨±å¯**
**èªå¯ = å„æ–½è¨­ã®åˆ©ç”¨æ¨©é™**

---

# å…·ä½“ä¾‹ï¼šSNSã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

## Twitterã‚’ä¾‹ã«è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†

### èªè¨¼ã®ã‚¹ãƒ†ãƒƒãƒ—
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›
2. ã‚·ã‚¹ãƒ†ãƒ ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ç…§åˆ
3. ä¸€è‡´ã™ã‚Œã°ã€Œã‚ãªãŸã¯@username ã•ã‚“ã§ã™ã­ã€ã¨èªè¨¼

### èªå¯ã®ã‚¹ãƒ†ãƒƒãƒ—
1. **è‡ªåˆ†ã®ãƒ„ã‚¤ãƒ¼ãƒˆ**: ç·¨é›†ãƒ»å‰Šé™¤å¯èƒ½ âœ…
2. **ä»–äººã®ãƒ„ã‚¤ãƒ¼ãƒˆ**: é–²è¦§ã®ã¿ï¼ˆç·¨é›†ãƒ»å‰Šé™¤ä¸å¯ï¼‰âŒ
3. **ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**: ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ã®ã¿é–²è¦§å¯èƒ½
4. **ç®¡ç†è€…æ©Ÿèƒ½**: ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯

---

# éŠ€è¡Œã‚·ã‚¹ãƒ†ãƒ ã§ã®èªè¨¼ãƒ»èªå¯

## ã‚ˆã‚Šå³å¯†ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŒå¿…è¦ãªä¾‹

```mermaid
sequenceDiagram
    participant User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant ATM as ATM/ã‚¢ãƒ—ãƒª
    participant Auth as èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 
    participant Bank as éŠ€è¡Œã‚·ã‚¹ãƒ†ãƒ 

    User->>ATM: ã‚«ãƒ¼ãƒ‰æŒ¿å…¥ + æš—è¨¼ç•ªå·
    ATM->>Auth: èªè¨¼è¦æ±‚
    Auth->>Auth: æœ¬äººç¢ºèª
    Auth->>ATM: èªè¨¼æˆåŠŸ

    User->>ATM: 100ä¸‡å††å¼•ãå‡ºã—è¦æ±‚
    ATM->>Bank: èªå¯ç¢ºèª
    Bank->>Bank: æ®‹é«˜ç¢ºèª
    Bank->>Bank: 1æ—¥ã®é™åº¦é¡ç¢ºèª
    Bank->>ATM: èªå¯ï¼ˆ50ä¸‡å††ã¾ã§ï¼‰
    ATM->>User: 50ä¸‡å††ã®ã¿å¼•ãå‡ºã—å¯èƒ½
```

---

# ã‚ˆãã‚ã‚‹èª¤è§£ã¨è½ã¨ã—ç©´

## âŒ é–“é•ã£ãŸç†è§£

ã€Œãƒ­ã‚°ã‚¤ãƒ³ã—ãŸã‚‰ä½•ã§ã‚‚ã§ãã‚‹ã€
â†’ **ã“ã‚Œã¯èªè¨¼ã¨èªå¯ã‚’æ··åŒã—ã¦ã„ã‚‹**

## âœ… æ­£ã—ã„ç†è§£

1. **ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆèªè¨¼ï¼‰**: ã‚·ã‚¹ãƒ†ãƒ ã«ã€Œç§ã¯å±±ç”°å¤ªéƒã§ã™ã€ã¨è¨¼æ˜
2. **æ¨©é™ç¢ºèªï¼ˆèªå¯ï¼‰**: å±±ç”°å¤ªéƒã•ã‚“ãŒã§ãã‚‹ã“ã¨ã‚’ç¢ºèª
   - è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†: OK
   - ä»–äººã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†: NG
   - ç®¡ç†ç”»é¢ã‚¢ã‚¯ã‚»ã‚¹: NGï¼ˆç®¡ç†è€…ã§ã¯ãªã„ãŸã‚ï¼‰

---

# ãªãœèªè¨¼ã‚’è‡ªä½œã—ã¦ã¯ã„ã‘ãªã„ã®ã‹ï¼Ÿ

## ã€Œèªè¨¼ã®è‡ªä½œ = æ‰‹è¡“ã‚’ç´ äººãŒè¡Œã†ã‚ˆã†ãªã‚‚ã®ã€

### è€ƒãˆã¦ã¿ã¦ãã ã•ã„
- è‡ªå®…ã®éµã‚’è‡ªä½œã—ã¾ã™ã‹ï¼Ÿ
- éŠ€è¡Œã®é‡‘åº«ã‚’è‡ªä½œã—ã¾ã™ã‹ï¼Ÿ
- ãƒ‘ã‚¹ãƒãƒ¼ãƒˆã‚’è‡ªä½œã—ã¾ã™ã‹ï¼Ÿ

**ç­”ãˆï¼šNO**

åŒã˜ã‚ˆã†ã«ã€Webã‚¢ãƒ—ãƒªã®èªè¨¼ã‚‚
**å°‚é–€å®¶ãŒä½œã£ãŸä»•çµ„ã¿ã‚’ä½¿ã†ã¹ã**ã§ã™

---

# èªè¨¼è‡ªä½œã®æã‚ã—ã„ç¾å®Ÿ - æŠ€è¡“çš„è¤‡é›‘æ€§

## ã‚ãªãŸã¯ä»¥ä¸‹ã®ã™ã¹ã¦ã‚’æ­£ã—ãå®Ÿè£…ã§ãã¾ã™ã‹ï¼Ÿ

### ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†
- **bcrypt/scrypt/Argon2** ã§ã®ãƒãƒƒã‚·ãƒ¥åŒ–ï¼ˆMD5ã‚„SHA-1ã¯è«–å¤–ï¼‰
- **ã‚½ãƒ«ãƒˆ**ã®é©åˆ‡ãªç”Ÿæˆã¨ç®¡ç†
- **ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«æ”»æ’ƒ**ã¸ã®å¯¾ç­–

### ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- **CSRFï¼ˆã‚¯ãƒ­ã‚¹ã‚µã‚¤ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ã‚¸ã‚§ãƒªï¼‰**å¯¾ç­–
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒã‚¤ã‚¸ãƒ£ãƒƒã‚¯**é˜²æ­¢
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³å›ºå®šæ”»æ’ƒ**ã¸ã®å¯¾å¿œ
- é©åˆ‡ãªã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š

---

# èªè¨¼è‡ªä½œã®æã‚ã—ã„ç¾å®Ÿ - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„…å¨

## æ—¥ã€…é€²åŒ–ã™ã‚‹æ”»æ’ƒæ‰‹æ³•ã¸ã®å¯¾å¿œ

### 2025å¹´ã®æœ€æ–°è„…å¨
- **AIã‚’ä½¿ã£ãŸç·å½“ãŸã‚Šæ”»æ’ƒ**
- **ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ•ã‚§ã‚¤ã‚¯ã«ã‚ˆã‚‹ãªã‚Šã™ã¾ã—**
- **é‡å­ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¸ã®å¯¾ç­–æº–å‚™**
- **ã‚¼ãƒ­ãƒ‡ã‚¤è„†å¼±æ€§ã¸ã®å³æ™‚å¯¾å¿œ**

### å®Ÿéš›ã®è¢«å®³ä¾‹
- **2023å¹´**: æŸã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã€èªè¨¼ã®å®Ÿè£…ãƒŸã‚¹ã§500ä¸‡äººã®å€‹äººæƒ…å ±æµå‡º
- **2024å¹´**: å¤§æ‰‹ECã‚µã‚¤ãƒˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®ä¸å‚™ã§1å„„å††ã®ä¸æ­£è³¼å…¥è¢«å®³
- **2025å¹´**: AIãƒœãƒƒãƒˆã«ã‚ˆã‚‹å¤§è¦æ¨¡ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¹—ã£å–ã‚Šï¼ˆè‡ªä½œèªè¨¼ã®ã‚µã‚¤ãƒˆãŒæ¨™çš„ï¼‰

---

# èªè¨¼è‡ªä½œã®æã‚ã—ã„ç¾å®Ÿ - æ³•çš„è²¬ä»»

## ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹é•åã®ãƒªã‚¹ã‚¯

### å¯¾å¿œãŒå¿…è¦ãªè¦åˆ¶
- **GDPRï¼ˆEUä¸€èˆ¬ãƒ‡ãƒ¼ã‚¿ä¿è­·è¦å‰‡ï¼‰**
  - é•åæ™‚ã®åˆ¶è£é‡‘ï¼šæœ€å¤§2000ä¸‡ãƒ¦ãƒ¼ãƒ­ã¾ãŸã¯å¹´é–“å£²ä¸Šã®4%
- **å€‹äººæƒ…å ±ä¿è­·æ³•ï¼ˆæ—¥æœ¬ï¼‰**
  - æœ€å¤§1å„„å††ã®ç½°é‡‘
- **CCPAï¼ˆã‚«ãƒªãƒ•ã‚©ãƒ«ãƒ‹ã‚¢å·æ¶ˆè²»è€…ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼æ³•ï¼‰**
- **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºæœ¬æ³•**

### å¿…è¦ãªæ©Ÿèƒ½
- ãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ã‚¿ãƒ“ãƒªãƒ†ã‚£ï¼ˆãƒ‡ãƒ¼ã‚¿ç§»è¡Œï¼‰
- å¿˜ã‚Œã‚‰ã‚Œã‚‹æ¨©åˆ©ï¼ˆãƒ‡ãƒ¼ã‚¿å‰Šé™¤ï¼‰
- åŒæ„ç®¡ç†ã¨ãƒ­ã‚°è¨˜éŒ²
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆæ™‚ã®72æ™‚é–“ä»¥å†…ã®å ±å‘Šç¾©å‹™

---

# èªè¨¼è‡ªä½œã®æã‚ã—ã„ç¾å®Ÿ - æ©Ÿä¼šæå¤±

## æœ¬æ¥ã‚„ã‚‹ã¹ãã“ã¨ã«é›†ä¸­ã§ããªã„

```mermaid
graph LR
    subgraph "è‡ªä½œèªè¨¼ã®å ´åˆ"
        A[2-4é€±é–“] -->|èªè¨¼å®Ÿè£…| B[ãƒã‚°ä¿®æ­£]
        B -->|1é€±é–“| C[ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–]
        C -->|ç¶™ç¶šçš„| D[ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹]
        D -->|æ°¸ç¶šçš„| E[æ³•å¯¾å¿œ]
    end

    subgraph "Clerkä½¿ç”¨ã®å ´åˆ"
        F[30åˆ†] -->|è¨­å®šå®Œäº†| G[ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯é–‹ç™º]
        G -->|æ™‚é–“ã‚’æœ‰åŠ¹æ´»ç”¨| H[æ–°æ©Ÿèƒ½é–‹ç™º]
        H -->|ç«¶äº‰å„ªä½æ€§| I[å¸‚å ´æŠ•å…¥]
    end
```

**çµè«–ï¼šèªè¨¼ã«æ™‚é–“ã‚’ã‹ã‘ã¦ã„ã‚‹é–“ã«ã€ç«¶åˆã«å¸‚å ´ã‚’å¥ªã‚ã‚Œã‚‹**

---

# ç¾ä»£èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®è¦ä»¶

## 2025å¹´ã«æ±‚ã‚ã‚‰ã‚Œã‚‹èªè¨¼ã®æ¨™æº–

### å¿…é ˆè¦ä»¶
- **MFAï¼ˆå¤šè¦ç´ èªè¨¼ï¼‰**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ + SMS/ã‚¢ãƒ—ãƒªèªè¨¼
- **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ¬ã‚¹å¯¾å¿œ**: ç”Ÿä½“èªè¨¼ã€ãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯
- **ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ­ã‚°ã‚¤ãƒ³**: Googleã€Appleã€GitHubç­‰
- **SSOï¼ˆã‚·ãƒ³ã‚°ãƒ«ã‚µã‚¤ãƒ³ã‚ªãƒ³ï¼‰**: ä¼æ¥­å‘ã‘

### UXè¦ä»¶
- **ç™»éŒ²3ã‚¯ãƒªãƒƒã‚¯ä»¥å†…**
- **ãƒ­ã‚°ã‚¤ãƒ³2ç§’ä»¥å†…**
- **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¿˜ã‚Œå¯¾å¿œè‡ªå‹•åŒ–**
- **å¤šè¨€èªå¯¾å¿œ**

---

# ç¾ä»£ã®èªè¨¼ãƒˆãƒ¬ãƒ³ãƒ‰

## AIæ™‚ä»£ã®æ–°ã—ã„èªè¨¼ãƒ‘ãƒ©ãƒ€ã‚¤ãƒ 

### ã‚¼ãƒ­ãƒˆãƒ©ã‚¹ãƒˆèªè¨¼
ã€Œèª°ã‚‚ä¿¡ç”¨ã—ãªã„ã€å‰æã§ã‚·ã‚¹ãƒ†ãƒ ã‚’è¨­è¨ˆ
- ç¶™ç¶šçš„ãªèªè¨¼ï¼ˆã‚¢ã‚¯ã‚»ã‚¹ã”ã¨ã«æ¤œè¨¼ï¼‰
- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆèªè¨¼ï¼ˆå ´æ‰€ã€ãƒ‡ãƒã‚¤ã‚¹ã€æ™‚é–“ï¼‰
- ãƒªã‚¹ã‚¯ãƒ™ãƒ¼ã‚¹èªè¨¼ï¼ˆAIã«ã‚ˆã‚‹ç•°å¸¸æ¤œçŸ¥ï¼‰

### åˆ†æ•£å‹ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£
- **DIDï¼ˆDecentralized Identifiersï¼‰**
- ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ãƒ™ãƒ¼ã‚¹ã®èªè¨¼
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸»æ¨©å‹ã®ãƒ‡ãƒ¼ã‚¿ç®¡ç†

---

# èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹ã®ROIè¨ˆç®—

## å®Ÿéš›ã®ã‚³ã‚¹ãƒˆã‚’æ¯”è¼ƒã—ã¦ã¿ã¾ã—ã‚‡ã†

### è‡ªä½œèªè¨¼ã®ã‚³ã‚¹ãƒˆ
| é …ç›® | è²»ç”¨ |
|------|------|
| åˆæœŸé–‹ç™ºï¼ˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢2åÃ—1ãƒ¶æœˆï¼‰ | 200ä¸‡å†† |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ» | 100ä¸‡å†† |
| å¹´é–“ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ | 120ä¸‡å†† |
| ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œãƒªã‚¹ã‚¯ | âˆï¼ˆè¨ˆæ¸¬ä¸èƒ½ï¼‰ |
| **å¹´é–“åˆè¨ˆ** | **420ä¸‡å††+Î±** |

### Clerkã®ã‚³ã‚¹ãƒˆ
| é …ç›® | è²»ç”¨ |
|------|------|
| Pro ãƒ—ãƒ©ãƒ³ï¼ˆæœˆé¡ï¼‰ | 2.5ä¸‡å†† |
| å®Ÿè£…å·¥æ•°ï¼ˆ30åˆ†ï¼‰ | å®Ÿè³ª0å†† |
| **å¹´é–“åˆè¨ˆ** | **30ä¸‡å††** |

**ROIï¼š1400%ã®æ”¹å–„ï¼ˆ14å€ã®ã‚³ã‚¹ãƒˆåŠ¹ç‡ï¼‰**

---

# ãƒ‘ãƒ¼ãƒˆ2ï¼šClerkæ¦‚è«–ã¨Googleèªè¨¼è¨­å®š
## 25åˆ†

---

# ğŸš€ Clerkï¼šèªè¨¼UXã®é©å‘½

## ãªãœClerkãªã®ã‹ï¼Ÿ

### å¾“æ¥ã®èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹ã®å•é¡Œç‚¹
- **Auth0**: è¤‡é›‘ãªè¨­å®šã€é«˜é¡ãªæ–™é‡‘
- **Firebase Auth**: Googleä¾å­˜ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ€§ã®ä½ã•
- **AWS Cognito**: å­¦ç¿’æ›²ç·šãŒæ€¥å³»ã€UXãŒå¤ã„

### Clerkã®é©æ–°
- **é–‹ç™ºè€…ä½“é¨“ï¼ˆDXï¼‰æœ€å„ªå…ˆ**
- **æœ€æ–°ã®UI/UXã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**
- **30åˆ†ã§æœ¬ç•ªç’°å¢ƒãƒ¬ãƒ™ãƒ«ã®èªè¨¼**

---

# ClerkãŒè§£æ±ºã™ã‚‹èª²é¡Œ

## Before & After ã®åŠ‡çš„ãªé•ã„

```mermaid
graph TD
    subgraph "Before: å¾“æ¥ã®èªè¨¼é–‹ç™º"
        A1[è¦ä»¶å®šç¾©] -->|1é€±é–“| B1[DBè¨­è¨ˆ]
        B1 -->|2é€±é–“| C1[èªè¨¼å®Ÿè£…]
        C1 -->|1é€±é–“| D1[UIä½œæˆ]
        D1 -->|1é€±é–“| E1[ãƒ†ã‚¹ãƒˆ]
        E1 -->|ç¶™ç¶š| F1[ãƒã‚°ä¿®æ­£]
    end

    subgraph "After: Clerkä½¿ç”¨"
        A2[Clerkã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—] -->|5åˆ†| B2[è¨­å®š]
        B2 -->|10åˆ†| C2[å®Ÿè£…]
        C2 -->|15åˆ†| D2[å®Œæˆï¼]
    end
```

**5é€±é–“ â†’ 30åˆ†ï¼ˆ240å€ã®é«˜é€ŸåŒ–ï¼‰**

---

# Clerk vs ä»–ã®èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹

## è©³ç´°ãªæ¯”è¼ƒè¡¨

| æ©Ÿèƒ½ | Clerk | Auth0 | Firebase | Supabase Auth |
|------|-------|-------|----------|---------------|
| **ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ™‚é–“** | 30åˆ† | 2-3æ™‚é–“ | 1æ™‚é–“ | 1æ™‚é–“ |
| **UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ** | â— ç¾ã—ã„ | â–³ æ™®é€š | â–³ åŸºæœ¬çš„ | Ã— è‡ªä½œå¿…è¦ |
| **ä¾¡æ ¼ï¼ˆæœˆé¡ï¼‰** | $25ï½ | $240ï½ | $0ï½ | $0ï½ |
| **æ—¥æœ¬èªå¯¾å¿œ** | â—‹ | â—‹ | â–³ | Ã— |
| **é–‹ç™ºè€…ä½“é¨“** | â— æœ€é«˜ | â—‹ è‰¯ã„ | â—‹ è‰¯ã„ | â–³ æ™®é€š |
| **ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ€§** | â— | â— | â—‹ | â— |
| **ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºæ©Ÿèƒ½** | â— | â— | â–³ | â–³ |

---

# Clerkã®ä¸»è¦æ©Ÿèƒ½

## ã™ã¹ã¦ãŒã€Œã™ãã«ä½¿ãˆã‚‹ã€çŠ¶æ…‹ã§æä¾›

### èªè¨¼æ–¹æ³•
- **ãƒ¡ãƒ¼ãƒ« + ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**
- **ãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ¬ã‚¹ï¼‰**
- **SMSèªè¨¼**
- **ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ­ã‚°ã‚¤ãƒ³**ï¼ˆ20+ ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼‰
- **Web3ã‚¦ã‚©ãƒ¬ãƒƒãƒˆèªè¨¼**

### UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- **SignIn / SignUp** - ç¾ã—ã„ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
- **UserButton** - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç®¡ç†
- **UserProfile** - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ç”»é¢
- **OrganizationSwitcher** - çµ„ç¹”åˆ‡ã‚Šæ›¿ãˆ

---

# Clerkã®2025å¹´æœ€æ–°æ©Ÿèƒ½

## æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®é©æ–°çš„ãªæ©Ÿèƒ½

### Native Supabase Integrationï¼ˆNEW!ï¼‰
```typescript
// 2025å¹´ç‰ˆï¼šSupabaseã¨ã®ç›´æ¥çµ±åˆ
import { clerkClient } from '@clerk/nextjs/server';

// Clerkã®JWTã‚’è‡ªå‹•çš„ã«Supabaseã«æ¸¡ã™
const supabase = createClient({
  auth: {
    provider: 'clerk', // æ–°æ©Ÿèƒ½ï¼
    clerkPublishableKey: process.env.CLERK_PUBLISHABLE_KEY
  }
});
```

### AI-Powered Fraud Detection
- æ©Ÿæ¢°å­¦ç¿’ã«ã‚ˆã‚‹ä¸æ­£ãƒ­ã‚°ã‚¤ãƒ³æ¤œçŸ¥
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è„…å¨åˆ†æ
- è‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯æ©Ÿèƒ½

---

# OAuth 2.0ã®ä»•çµ„ã¿

## Googleèªè¨¼ã®è£å´ã‚’ç†è§£ã™ã‚‹

```mermaid
sequenceDiagram
    participant User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant App as ã‚ãªãŸã®ã‚¢ãƒ—ãƒª
    participant Clerk as Clerk
    participant Google as Google

    User->>App: ã€ŒGoogleã§ãƒ­ã‚°ã‚¤ãƒ³ã€ã‚¯ãƒªãƒƒã‚¯
    App->>Clerk: èªè¨¼é–‹å§‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    Clerk->>Google: OAuthèªè¨¼è¦æ±‚
    Google->>User: Googleãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
    User->>Google: ãƒ¡ãƒ¼ãƒ«/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›
    Google->>Google: èªè¨¼ç¢ºèª
    Google->>Clerk: èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³è¿”å´
    Clerk->>Clerk: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ç”Ÿæˆ
    Clerk->>App: JWT Tokenç™ºè¡Œ
    App->>User: ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼
```

---

# OAuth 2.0ã®é‡è¦æ¦‚å¿µ

## ç†è§£ã™ã¹ã4ã¤ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰

### 1. Client IDï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDï¼‰
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã€Œèº«åˆ†è¨¼æ˜æ›¸ã€
- å…¬é–‹æƒ…å ±ï¼ˆç§˜å¯†ã§ã¯ãªã„ï¼‰
- ä¾‹ï¼š`123456789.apps.googleusercontent.com`

### 2. Client Secretï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆï¼‰
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã€Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€
- **çµ¶å¯¾ã«å…¬é–‹ã—ã¦ã¯ã„ã‘ãªã„**
- ä¾‹ï¼š`GOCSPX-xxxxxxxxxxxxx`

### 3. Redirect URIï¼ˆãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIï¼‰
- èªè¨¼å¾Œã®æˆ»ã‚Šå…ˆURL
- äº‹å‰ç™»éŒ²ãŒå¿…é ˆï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãŸã‚ï¼‰
- ä¾‹ï¼š`https://accounts.clerk.dev/oauth/google/callback`

### 4. Scopeï¼ˆã‚¹ã‚³ãƒ¼ãƒ—ï¼‰
- ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã®ç¯„å›²
- ä¾‹ï¼š`email`, `profile`, `openid`

---

# ğŸ“± Googleèªè¨¼ã®è¨­å®šï¼ˆ2025å¹´9æœˆæœ€æ–°ç‰ˆï¼‰

## é–‹ç™ºã¨æœ¬ç•ªã®é•ã„ã‚’ç†è§£ã—ã‚ˆã†

### ğŸ‰ é–‹ç™ºç’°å¢ƒï¼ˆä»Šæ—¥ä½¿ã†ã‚‚ã®ï¼‰
**å¿…è¦ãªä½œæ¥­**: Clerk Dashboardã§Googleã‚’ONï¼ˆ10ç§’ï¼‰
**Google Cloud Console**: **ä¸è¦ï¼**
**ç†ç”±**: ClerkãŒé–‹ç™ºç”¨ã®å…±æœ‰èªè¨¼æƒ…å ±ã‚’è‡ªå‹•æä¾›

```mermaid
graph LR
    A[1. Clerk Dashboardé–‹ã] -->
    B[2. Googleã‚¹ã‚¤ãƒƒãƒ ON] -->
    C[å®Œæˆï¼ğŸ‰]

    style A fill:#e1f5fe
    style B fill:#81d4fa
    style C fill:#29b6f6,color:#fff
```

### ğŸš€ æœ¬ç•ªç’°å¢ƒï¼ˆSession 4ã§å­¦ç¿’ï¼‰
**å¿…è¦ãªä½œæ¥­**: Google Cloud Consoleè¨­å®š
**ã„ã¤å¿…è¦**:
- Vercelã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ™‚
- ç‹¬è‡ªãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½¿ã†æ™‚
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å…¬é–‹ã™ã‚‹æ™‚

**ä»Šã¯**: ã‚¹ã‚­ãƒƒãƒ—ã—ã¦OKï¼è©³ç´°ã¯Session 4ã§è§£èª¬

---

# Clerk Dashboardè¨­å®š

## Clerkã§ã®è¨­å®šæ‰‹é †

### 1. Clerkã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
```
https://dashboard.clerk.com/sign-up
```

### 2. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åã‚’å…¥åŠ›
- é–‹ç™ºç’°å¢ƒURLã‚’è¨­å®šï¼ˆlocalhost:3000ãªã©ï¼‰

### 3. ã‚½ãƒ¼ã‚·ãƒ£ãƒ«æ¥ç¶šã®è¨­å®š
1. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€ŒUser & Authenticationã€
2. ã€ŒSocial Connectionsã€é¸æŠ
3. ã€ŒGoogleã€ã‚’æœ‰åŠ¹åŒ–
4. Client IDãƒ»Client Secretã‚’å…¥åŠ›
5. ä¿å­˜

---

# Clerkã®ç’°å¢ƒå¤‰æ•°è¨­å®š

## Next.jsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®è¨­å®š

### .env.localãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
```bash
# Clerkè¨­å®š
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_xxxxxxxxxxxxx
CLERK_SECRET_KEY=sk_test_xxxxxxxxxxxxx

# URLè¨­å®š
NEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in
NEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up
NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL=/dashboard
NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL=/onboarding

# Supabaseé€£æºç”¨ï¼ˆSession 3ã§ä½¿ç”¨ï¼‰
NEXT_PUBLIC_CLERK_SUPABASE_JWT_TEMPLATE=supabase-jwt
```

**é‡è¦**: `.env.local`ã¯`.gitignore`ã«å¿…ãšè¿½åŠ ã™ã‚‹ã“ã¨ï¼

---

# ãƒ‘ãƒ¼ãƒˆ3ï¼šNext.js + Clerkå®Ÿè£…
## 25åˆ†

---

# ğŸ‘¡ ãƒ‘ãƒ¼ãƒˆ3ï¼šAIã§èªè¨¼å®Ÿè£…ï¼ˆå®Œå…¨ç†è§£ç‰ˆï¼‰
## 25åˆ†

---

# ğŸ¤– 2025å¹´æœ€æ–°ï¼šã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã‹ãªã„æ™‚ä»£

## ã§ã‚‚ã€ä½•ãŒèµ·ãã¦ã„ã‚‹ã‹ã¯ç†è§£ã—ã‚ˆã†ï¼

### ã“ã®ãƒ‘ãƒ¼ãƒˆã§å­¦ã¶ã“ã¨
1. **AIã«èªè¨¼ã‚’å®Ÿè£…ã•ã›ã‚‹æ–¹æ³•**
2. **ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã®æ„å‘³**
3. **é‡è¦ãªç”¨èªã¨è¨­å®šé …ç›®**
4. **ãƒˆãƒ©ãƒ–ãƒ«æ™‚ã®å¯¾å‡¦æ³•**

### å¤§åˆ‡ãªè€ƒãˆæ–¹
- ã‚³ãƒ¼ãƒ‰ã¯**æ›¸ã‹ãªãã¦ã„ã„**
- ã§ã‚‚**æ„å‘³ã¯ç†è§£ã™ã‚‹**
- AIã¯**ã‚ãªãŸã®æŒ‡ç¤ºã§å‹•ã**

---

# ğŸ“š ã¾ãšç”¨èªã‚’ç†è§£ã—ã‚ˆã†

## èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®é‡è¦ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰

### ç’°å¢ƒå¤‰æ•°ï¼ˆã‹ã‚“ãã‚‡ã†ã¸ã‚“ã™ã†ï¼‰
**æ„å‘³**: ã‚¢ãƒ—ãƒªã®è¨­å®šæƒ…å ±ã‚’ä¿å­˜ã™ã‚‹ç‰¹åˆ¥ãªãƒ•ã‚¡ã‚¤ãƒ«
**ä¾‹ãˆ**: å®¶ã®éµã‚’éš ã—ã¦ãŠãå ´æ‰€
**ãªãœå¿…è¦**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãªã©ã®ç§˜å¯†æƒ…å ±ã‚’å®‰å…¨ã«ç®¡ç†

### APIã‚­ãƒ¼
**æ„å‘³**: ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ã†ãŸã‚ã®èªè¨¼ã‚³ãƒ¼ãƒ‰
**ä¾‹ãˆ**: ä¼šå“¡ã‚«ãƒ¼ãƒ‰ã®ç•ªå·
**2ç¨®é¡**:
- **Publishable Keyï¼ˆå…¬é–‹å¯èƒ½ï¼‰**: åº—é ­ã«è¦‹ã›ã‚‹ä¼šå“¡ç•ªå·
- **Secret Keyï¼ˆç§˜å¯†ï¼‰**: æš—è¨¼ç•ªå·ï¼ˆçµ¶å¯¾ã«ç§˜å¯†ï¼ï¼‰

### Providerï¼ˆãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼‰
**æ„å‘³**: ã‚¢ãƒ—ãƒªå…¨ä½“ã«æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ä»•çµ„ã¿
**ä¾‹ãˆ**: å»ºç‰©å…¨ä½“ã®é›»æ°—ã‚’ä¾›çµ¦ã™ã‚‹é…é›»ç›¤
**ClerkProvider**: èªè¨¼æ©Ÿèƒ½ã‚’å…¨ç”»é¢ã§ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹

---

# ğŸŒŸ Clerk AI Promptsã®ä½¿ã„æ–¹

## ãŸã£ãŸ3ã‚¹ãƒ†ãƒƒãƒ—ã§èªè¨¼å®Ÿè£…

### ã‚¹ãƒ†ãƒƒãƒ—1ï¼šClerkã§ã‚¢ãƒ—ãƒªä½œæˆï¼ˆ2åˆ†ï¼‰
1. https://dashboard.clerk.com ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã€ŒCreate applicationã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ã‚¢ãƒ—ãƒªåã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šmy-social-appï¼‰
4. ã€ŒGoogleã€ã‚’ONã«ã™ã‚‹ â† **ã“ã‚Œã ã‘ï¼**

### ã‚¹ãƒ†ãƒƒãƒ—2ï¼šå…¬å¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå–å¾—ï¼ˆ30ç§’ï¼‰
1. https://clerk.com/docs/ai-prompts/nextjs ã‚’é–‹ã
2. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¨ä½“ã‚’é¸æŠã—ã¦ã‚³ãƒ”ãƒ¼

### ã‚¹ãƒ†ãƒƒãƒ—3ï¼šCursorã§å®Ÿè¡Œï¼ˆ2åˆ†ï¼‰
1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã‚’é–‹ã
2. `.cursorrules`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
3. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è²¼ã‚Šä»˜ã‘
4. ã€ŒClerkèªè¨¼ã‚’å®Ÿè£…ã—ã¦ã€ã¨å…¥åŠ›

**å®Œæˆï¼ğŸ‰**

---

# ğŸ”‘ ç’°å¢ƒå¤‰æ•°ã®å®Œå…¨ç†è§£

## .env.localãƒ•ã‚¡ã‚¤ãƒ«ã£ã¦ä½•ï¼Ÿ

### ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²
```
.env.local = ã‚ãªãŸã®ã‚¢ãƒ—ãƒªã®ã€Œç§˜å¯†ã®ãƒ¡ãƒ¢å¸³ã€
```

### ä¸­èº«ã®æ§‹é€ ï¼ˆå®Ÿéš›ã®ä¾‹ï¼‰
```bash
# ã“ã‚ŒãŒPublishable Keyï¼ˆå…¬é–‹ã—ã¦ã‚‚OKï¼‰
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_abc123...
#    â†‘                  â†‘              â†‘
#  å…¬é–‹OK           å¤‰æ•°ã®åå‰       Clerkã‹ã‚‰ã‚‚ã‚‰ã£ãŸå€¤

# ã“ã‚ŒãŒSecret Keyï¼ˆçµ¶å¯¾ã«ç§˜å¯†ï¼ï¼‰
CLERK_SECRET_KEY=sk_test_xyz789...
#      â†‘            â†‘
#  ç§˜å¯†ã‚’è¡¨ã™    Clerkã‹ã‚‰ã‚‚ã‚‰ã£ãŸç§˜å¯†ã®å€¤
```

### ãªãœNEXT_PUBLIC_ãŒã¤ãï¼Ÿ
- **NEXT_PUBLIC_ã‚ã‚Š** = ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚‚ä½¿ã†è¨­å®š
- **NEXT_PUBLIC_ãªã—** = ã‚µãƒ¼ãƒãƒ¼ã ã‘ã§ä½¿ã†ç§˜å¯†è¨­å®š

---

# ğŸ” AIãŒç”Ÿæˆã—ãŸã‚³ãƒ¼ãƒ‰ã®èª­ã¿æ–¹

## ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¨å½¹å‰²

### 1. `.env.local`ï¼ˆç’°å¢ƒè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
```bash
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_xxx
# â†‘ ã“ã‚ŒãŒã‚ãªãŸã®ã‚¢ãƒ—ãƒªã®ã€Œèº«åˆ†è¨¼æ˜æ›¸ã€

CLERK_SECRET_KEY=sk_test_yyy
# â†‘ ã“ã‚ŒãŒã‚ãªãŸã®ã‚¢ãƒ—ãƒªã®ã€Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€
```

### 2. `layout.tsx`ï¼ˆå…¨ä½“è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
AIãŒç”Ÿæˆã™ã‚‹ã‚³ãƒ¼ãƒ‰ï¼š
```typescript
<ClerkProvider>
  {children}
</ClerkProvider>
```
**æ„å‘³**: ã€Œã“ã®ã‚¢ãƒ—ãƒªå…¨ä½“ã§Clerkã®èªè¨¼æ©Ÿèƒ½ã‚’ä½¿ã„ã¾ã™ã€

### 3. `middleware.ts`ï¼ˆé–€ç•ªãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
**å½¹å‰²**: èª°ãŒã©ã®ãƒšãƒ¼ã‚¸ã‚’è¦‹ã‚‰ã‚Œã‚‹ã‹ç®¡ç†
**ä¾‹ãˆ**: ãƒãƒ³ã‚·ãƒ§ãƒ³ã®ç®¡ç†äººã•ã‚“

---

# ğŸ“Š é‡è¦ãªè¨­å®šé …ç›®ã®æ„å‘³

## publicRoutesï¼ˆå…¬é–‹ãƒ«ãƒ¼ãƒˆï¼‰
**æ„å‘³**: ãƒ­ã‚°ã‚¤ãƒ³ã—ãªãã¦ã‚‚è¦‹ã‚‰ã‚Œã‚‹ãƒšãƒ¼ã‚¸
**ä¾‹**:
- `/` = ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸
- `/about` = ä¼šç¤¾æ¦‚è¦
- `/sign-in` = ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢

## protectedRoutesï¼ˆä¿è­·ãƒ«ãƒ¼ãƒˆï¼‰
**æ„å‘³**: ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ãªãƒšãƒ¼ã‚¸
**ä¾‹**:
- `/dashboard` = ç®¡ç†ç”»é¢
- `/profile` = ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«
- `/settings` = è¨­å®šç”»é¢

## afterSignInUrlï¼ˆãƒ­ã‚°ã‚¤ãƒ³å¾Œã®URLï¼‰
**æ„å‘³**: ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸå¾Œã«ç§»å‹•ã™ã‚‹ãƒšãƒ¼ã‚¸
**è¨­å®šä¾‹**: `/dashboard`ï¼ˆç®¡ç†ç”»é¢ã¸ï¼‰

---

# ğŸ·ï¸ Clerkã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ„å‘³

## AIãŒä½¿ã†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¾å…¸

### SignInButtonï¼ˆã‚µã‚¤ãƒ³ã‚¤ãƒ³ãƒœã‚¿ãƒ³ï¼‰
**å½¹å‰²**: ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹ãƒœã‚¿ãƒ³
**ä½¿ã„å ´æ‰€**: æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸

### SignUpButtonï¼ˆã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒœã‚¿ãƒ³ï¼‰
**å½¹å‰²**: æ–°è¦ç™»éŒ²ç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹ãƒœã‚¿ãƒ³
**ä½¿ã„å ´æ‰€**: æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸

### UserButtonï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒœã‚¿ãƒ³ï¼‰
**å½¹å‰²**: ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼
**è¡¨ç¤ºå†…å®¹**:
- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ
- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†
- ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ

### SignedIn / SignedOut
**å½¹å‰²**: ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã§è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
**ä¾‹**:
- SignedInå†… = ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ã¿è¡¨ç¤º
- SignedOutå†… = æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ã¿è¡¨ç¤º

---

# ğŸ†˜ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®èª­ã¿æ–¹

## ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨æ„å‘³

### ã€ŒMissing NEXT_PUBLIC_CLERK_PUBLISHABLE_KEYã€
**æ„å‘³**: ã€Œå…¬é–‹ã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€
**åŸå› **: .env.localãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„ã‹ã€ã‚­ãƒ¼åãŒé•ã†
**å¯¾å‡¦**:
```
AIã«ä¼ãˆã‚‹ï¼šã€Œç’°å¢ƒå¤‰æ•°ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã›ã‚“ã€
```

### ã€ŒClerkProvider is not definedã€
**æ„å‘³**: ã€ŒClerkProviderãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€
**åŸå› **: ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¿˜ã‚Œ
**å¯¾å‡¦**:
```
AIã«ä¼ãˆã‚‹ï¼šã€ŒClerkProviderã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€
```

### ã€ŒInvalid authenticationã€
**æ„å‘³**: ã€Œèªè¨¼æƒ…å ±ãŒç„¡åŠ¹ã§ã™ã€
**åŸå› **: Secret KeyãŒé–“é•ã£ã¦ã„ã‚‹
**å¯¾å‡¦**:
```
AIã«ä¼ãˆã‚‹ï¼šã€ŒSecret Keyã‚’ç¢ºèªã—ã¦å†è¨­å®šã—ã¦ãã ã•ã„ã€
```

---

# ğŸ“ AIã¸ã®æŒ‡ç¤ºã®å‡ºã—æ–¹

## åŠ¹æœçš„ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ›¸ãæ–¹

### åŸºæœ¬ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
```
Clerkå…¬å¼ã®Next.js App Routerç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä½¿ç”¨ã—ã¦èªè¨¼ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚

ç’°å¢ƒè¨­å®šï¼š
- Publishable Key: [ã“ã“ã«pk_test_ã‚’è²¼ã‚‹]
- Secret Key: [ã“ã“ã«sk_test_ã‚’è²¼ã‚‹]

å®Ÿè£…å†…å®¹ï¼š
1. å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
2. ç’°å¢ƒå¤‰æ•°ã‚’.env.localã«ä¿å­˜
3. å…¨ãƒšãƒ¼ã‚¸ã§èªè¨¼ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«è¨­å®š
4. ãƒ­ã‚°ã‚¤ãƒ³/ãƒ­ã‚°ã‚¢ã‚¦ãƒˆç”»é¢ã‚’ä½œæˆ
5. Googleãƒ­ã‚°ã‚¤ãƒ³ã‚’æœ‰åŠ¹åŒ–

æ³¨æ„äº‹é …ï¼š
- TypeScriptã‚’ä½¿ç”¨
- ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã‚‰æ—¥æœ¬èªã§èª¬æ˜
```

---

# ğŸ“Œ ç”¨èªãƒãƒ¼ãƒˆã‚·ãƒ¼ãƒˆ

## èªè¨¼é–¢é€£ã®é‡è¦ç”¨èªé›†

| ç”¨èª | èª­ã¿æ–¹ | æ„å‘³ | ä¾‹ãˆ |
|-----|-------|------|------|
| Authentication | ã‚ªãƒ¼ã‚»ãƒ³ãƒ†ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ | æœ¬äººç¢ºèª | èº«åˆ†è¨¼æ˜æ›¸ã®ç¢ºèª |
| Authorization | ã‚ªãƒ¼ã‚½ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ | æ¨©é™ç¢ºèª | å…¥é¤¨è¨¼ã®æ¨©é™ãƒã‚§ãƒƒã‚¯ |
| Provider | ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ | æ©Ÿèƒ½æä¾›è€… | é›»åŠ›ä¼šç¤¾ |
| Middleware | ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ | ä¸­é–“å‡¦ç† | é–€ç•ª |
| Environment Variable | ã‚¨ãƒ³ãƒã‚¤ãƒ­ãƒ¡ãƒ³ãƒˆ ãƒãƒªã‚¢ãƒ–ãƒ« | ç’°å¢ƒå¤‰æ•° | è¨­å®šãƒ¡ãƒ¢ |
| Public Route | ãƒ‘ãƒ–ãƒªãƒƒã‚¯ ãƒ«ãƒ¼ãƒˆ | å…¬é–‹ãƒšãƒ¼ã‚¸ | èª°ã§ã‚‚å…¥ã‚Œã‚‹å ´æ‰€ |
| Protected Route | ãƒ—ãƒ­ãƒ†ã‚¯ãƒ†ãƒƒãƒ‰ ãƒ«ãƒ¼ãƒˆ | ä¿è­·ãƒšãƒ¼ã‚¸ | ä¼šå“¡é™å®šã‚¨ãƒªã‚¢ |
| Session | ã‚»ãƒƒã‚·ãƒ§ãƒ³ | ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ | å…¥é¤¨è¨¼ã®æœ‰åŠ¹æœŸé™ |
| Token | ãƒˆãƒ¼ã‚¯ãƒ³ | èªè¨¼ãƒã‚±ãƒƒãƒˆ | åˆ‡ç¬¦ |
| JWT | ã‚¸ã‚§ã‚¤ ãƒ€ãƒ–ãƒªãƒ¥ãƒ¼ ãƒ†ã‚£ãƒ¼ | èªè¨¼æƒ…å ±ã®å½¢å¼ | ãƒ‘ã‚¹ãƒãƒ¼ãƒˆ |

---

# ğŸ¤” ã‚ˆãã‚ã‚‹è³ªå•ã¨å›ç­”

## Qï¼šç”»é¢ãŒçœŸã£ç™½ã«ãªã‚Šã¾ã—ãŸ
**Aï¼š**Cursorã«ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š
ã€Œç”»é¢ãŒçœŸã£ç™½ã§ã™ã€‚Clerkèªè¨¼ã®è¨­å®šã‚’ç¢ºèªã—ã¦ä¿®æ­£ã—ã¦ãã ã•ã„ã€

## Qï¼šã€Œç’°å¢ƒå¤‰æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€ã‚¨ãƒ©ãƒ¼
**Aï¼š**ä»¥ä¸‹ã®æ‰‹é †ã§è§£æ±ºï¼š
1. `.env.local`ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã‹ç¢ºèª
2. ãªã‘ã‚Œã°Cursorã«ã€Œ.env.localãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦Clerkã®ã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ã€

## Qï¼šGoogleãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ãŒå‡ºãªã„
**Aï¼š**Clerk Dashboardã§GoogleãŒONã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª
1. https://dashboard.clerk.com ã‚’é–‹ã
2. ã‚ãªãŸã®ã‚¢ãƒ—ãƒªã‚’é¸æŠ
3. ã€ŒUser & Authenticationã€â†’ã€ŒSocial Connectionsã€
4. GoogleãŒONã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª

## Qï¼šãã‚Œã§ã‚‚å‹•ã‹ãªã„
**Aï¼š**Cursorã«ç”»é¢ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’è²¼ã£ã¦
ã€Œã“ã®ã‚¨ãƒ©ãƒ¼ã‚’è§£æ±ºã—ã¦ãã ã•ã„ã€ã¨å…¥åŠ›

---

# âœ… ç†è§£åº¦ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

## ã“ã‚ŒãŒåˆ†ã‹ã‚Œã°å®Œç’§ï¼

### ç”¨èªç†è§£
- [ ] ç’°å¢ƒå¤‰æ•°ãŒä½•ã‹èª¬æ˜ã§ãã‚‹
- [ ] Publishableã¨Secretã®é•ã„ãŒåˆ†ã‹ã‚‹
- [ ] Providerã®å½¹å‰²ãŒåˆ†ã‹ã‚‹

### è¨­å®šç†è§£
- [ ] .env.localãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²ãŒåˆ†ã‹ã‚‹
- [ ] publicRoutesã¨protectedRoutesã®é•ã„ãŒåˆ†ã‹ã‚‹
- [ ] NEXT_PUBLIC_ã®æ„å‘³ãŒåˆ†ã‹ã‚‹

### ãƒˆãƒ©ãƒ–ãƒ«å¯¾å¿œ
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ„å‘³ãŒåˆ†ã‹ã‚‹
- [ ] AIã¸ã®è³ªå•ã®ä»•æ–¹ãŒåˆ†ã‹ã‚‹
- [ ] ã©ã“ã‚’ç¢ºèªã™ã‚Œã°ã„ã„ã‹åˆ†ã‹ã‚‹

### å…¨ä½“ç†è§£
- [ ] èªè¨¼ã®æµã‚ŒãŒèª¬æ˜ã§ãã‚‹
- [ ] ãªãœClerkã‚’ä½¿ã†ã®ã‹èª¬æ˜ã§ãã‚‹
- [ ] Googleèªè¨¼ã®ä»•çµ„ã¿ãŒåˆ†ã‹ã‚‹

---

# ğŸŒ¯ å®Ÿè·µï¼šAIã¨ä¸€ç·’ã«å®Ÿè£…

## æº–å‚™ã‹ã‚‰å®Œæˆã¾ã§15åˆ†

### Phase 1ï¼šæº–å‚™ï¼ˆ3åˆ†ï¼‰
1. Clerk Dashboardã§ã‚¢ãƒ—ãƒªä½œæˆ
2. APIã‚­ãƒ¼ã‚’ãƒ¡ãƒ¢å¸³ã«ã‚³ãƒ”ãƒ¼
3. Cursorã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ã

### Phase 2ï¼šAIå®Ÿè£…ï¼ˆ5åˆ†ï¼‰
1. Clerkå…¬å¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼
2. APIã‚­ãƒ¼ã¨ä¸€ç·’ã«Cursorã«è²¼ä»˜ã‘
3. ã€Œå®Ÿè£…ã—ã¦ãã ã•ã„ã€ã¨æŒ‡ç¤º

### Phase 3ï¼šç¢ºèªï¼ˆ3åˆ†ï¼‰
1. `npm run dev`ã§ã‚¢ãƒ—ãƒªèµ·å‹•
2. ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. Googleã§ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼

### Phase 4ï¼šç†è§£ï¼ˆ4åˆ†ï¼‰
1. ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
2. å„è¨­å®šã®æ„å‘³ã‚’ç¢ºèª
3. ã“ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã¨ç…§ã‚‰ã—åˆã‚ã›

**ã§ããŸï¼ã“ã‚Œã§ã‚ãªãŸã‚‚èªè¨¼ãƒã‚¹ã‚¿ãƒ¼ï¼ğŸ‰**

---

# ğŸ”— Supabaseé€£æºã«ã¤ã„ã¦ï¼ˆæ¦‚è¦ã®ã¿ï¼‰

## Session 3-3ã§è©³ã—ãå­¦ã³ã¾ã™

### è¦šãˆã¦ãŠãã“ã¨
- **Clerk**: èªè¨¼ï¼ˆèª°ãªã®ã‹ï¼‰ã‚’ç®¡ç†
- **Supabase**: ãƒ‡ãƒ¼ã‚¿ï¼ˆä½•ãŒã§ãã‚‹ã‹ï¼‰ã‚’ç®¡ç†
- **é€£æºæ–¹æ³•**: JWTï¼ˆã‚¸ã‚§ã‚¤ãƒ€ãƒ–ãƒªãƒ¥ãƒ¼ãƒ†ã‚£ãƒ¼ï¼‰ã¨ã„ã†ä»•çµ„ã¿

### JWTã£ã¦ä½•ï¼Ÿ
**æ„å‘³**: JSON Web Tokenï¼ˆèªè¨¼æƒ…å ±ã®å—ã‘æ¸¡ã—å½¢å¼ï¼‰
**ä¾‹ãˆ**: ãƒ‘ã‚¹ãƒãƒ¼ãƒˆï¼ˆã©ã®å›½ã§ã‚‚é€šç”¨ã™ã‚‹èº«åˆ†è¨¼æ˜æ›¸ï¼‰
**åƒã**: ClerkãŒSupabaseã«ã€Œã“ã®äººã¯æœ¬äººã§ã™ã€ã¨è¨¼æ˜

### ä»Šã¯ç†è§£ä¸è¦
è©³ç´°ãªå®Ÿè£…ã¯Session 3-3ã§AIãŒå…¨éƒ¨ã‚„ã£ã¦ãã‚Œã¾ã™ï¼

---

# JWTçµ±åˆã®ä»•çµ„ã¿

## èªè¨¼ãƒ•ãƒ­ãƒ¼ã®å®Œå…¨ç†è§£

```mermaid
sequenceDiagram
    participant User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant Next as Next.js App
    participant Clerk as Clerk
    participant Supabase as Supabase DB

    User->>Next: ã‚¢ã‚¯ã‚»ã‚¹
    Next->>Clerk: èªè¨¼çŠ¶æ…‹ç¢ºèª
    Clerk->>Next: JWT Tokenç™ºè¡Œ

    User->>Next: ãƒ‡ãƒ¼ã‚¿å–å¾—è¦æ±‚
    Next->>Next: Clerkã®JWTå–å¾—
    Next->>Supabase: JWTä»˜ããƒªã‚¯ã‚¨ã‚¹ãƒˆ
    Supabase->>Supabase: JWTæ¤œè¨¼
    Supabase->>Supabase: RLSãƒãƒªã‚·ãƒ¼é©ç”¨
    Supabase->>Next: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿è¿”å´
    Next->>User: ç”»é¢è¡¨ç¤º
```

---

# 2025å¹´ç‰ˆï¼šNative Integration

## Clerkã®æœ€æ–°Supabaseçµ±åˆæ©Ÿèƒ½

### å¾“æ¥ã®æ–¹æ³•ï¼ˆ2024å¹´ã¾ã§ï¼‰
```typescript
// JWT Templateã‚’æ‰‹å‹•è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã£ãŸ
const supabaseClient = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
  {
    global: {
      fetch: async (url, options = {}) => {
        const clerkToken = await getToken({
          template: 'supabase-jwt' // æ‰‹å‹•è¨­å®š
        })
        // ...
      }
    }
  }
)
```

### 2025å¹´ã®æ–°æ–¹æ³•
```typescript
// ClerkãŒè‡ªå‹•çš„ã«Supabaseã¨é€£æº
import { createClerkSupabaseClient } from '@clerk/nextjs/server'

const supabase = createClerkSupabaseClient()
// JWTã®è¨­å®šã¯è‡ªå‹•åŒ–ï¼
```

---

# Supabaseå´ã®RLSè¨­å®š

## Row Level Securityã®å®Ÿè£…

```sql
-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ã®RLSãƒãƒªã‚·ãƒ¼
CREATE TABLE posts (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  content TEXT NOT NULL,
  author_id TEXT NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);

-- RLSã‚’æœ‰åŠ¹åŒ–
ALTER TABLE posts ENABLE ROW LEVEL SECURITY;

-- Clerk JWTã®subã‚¯ãƒ¬ãƒ¼ãƒ ã‚’ä½¿ç”¨ã—ãŸãƒãƒªã‚·ãƒ¼
CREATE POLICY "Users can view all posts"
  ON posts FOR SELECT
  USING (true);

CREATE POLICY "Users can insert own posts"
  ON posts FOR INSERT
  WITH CHECK (auth.jwt() ->> 'sub' = author_id);

CREATE POLICY "Users can update own posts"
  ON posts FOR UPDATE
  USING (auth.jwt() ->> 'sub' = author_id)
  WITH CHECK (auth.jwt() ->> 'sub' = author_id);

CREATE POLICY "Users can delete own posts"
  ON posts FOR DELETE
  USING (auth.jwt() ->> 'sub' = author_id);
```

---

# çµ±åˆå®Ÿè£…ã‚³ãƒ¼ãƒ‰

## lib/supabase/client.ts

```typescript
import { createClient } from '@supabase/supabase-js'
import { useAuth } from '@clerk/nextjs'

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ç”¨ãƒ•ãƒƒã‚¯
export function useSupabaseClient() {
  const { getToken } = useAuth()

  const supabase = createClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      global: {
        fetch: async (url, options = {}) => {
          const token = await getToken({ template: 'supabase' })

          const headers = new Headers(options.headers)
          headers.set('Authorization', `Bearer ${token}`)

          return fetch(url, { ...options, headers })
        },
      },
    }
  )

  return supabase
}
```

---

# ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰çµ±åˆ

## lib/supabase/server.ts

```typescript
import { createClient } from '@supabase/supabase-js'
import { auth } from '@clerk/nextjs'

// ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç”¨
export async function createServerSupabaseClient() {
  const { getToken } = auth()

  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!
  const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!

  const token = await getToken({ template: 'supabase' })

  const supabase = createClient(
    supabaseUrl,
    supabaseAnonKey,
    {
      global: {
        headers: {
          Authorization: `Bearer ${token}`,
        },
      },
    }
  )

  return supabase
}

// ä½¿ç”¨ä¾‹
export async function getPosts() {
  const supabase = await createServerSupabaseClient()

  const { data, error } = await supabase
    .from('posts')
    .select('*')
    .order('created_at', { ascending: false })

  if (error) throw error
  return data
}
```

---

# JWT Templateè¨­å®šï¼ˆClerk Dashboardï¼‰

## Supabaseç”¨ã‚«ã‚¹ã‚¿ãƒ JWTã®è¨­å®š

### Clerkãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§è¨­å®š
1. JWT Templates â†’ New Template
2. Name: `supabase`
3. Claims:
```json
{
  "aud": "authenticated",
  "role": "authenticated",
  "email": "{{user.primary_email_address}}",
  "sub": "{{user.id}}",
  "user_metadata": {
    "name": "{{user.full_name}}",
    "avatar_url": "{{user.image_url}}"
  }
}
```

### Lifetimeè¨­å®š
- 1æ™‚é–“ï¼ˆ3600ç§’ï¼‰æ¨å¥¨

---

# å®Ÿè£…ä¾‹ï¼šæŠ•ç¨¿æ©Ÿèƒ½

## CRUDæ“ä½œã®å®Ÿè£…

```typescript
// app/actions/posts.ts
'use server'

import { auth } from '@clerk/nextjs'
import { createServerSupabaseClient } from '@/lib/supabase/server'
import { revalidatePath } from 'next/cache'

export async function createPost(content: string) {
  const { userId } = auth()
  if (!userId) throw new Error('Unauthorized')

  const supabase = await createServerSupabaseClient()

  const { data, error } = await supabase
    .from('posts')
    .insert({
      content,
      author_id: userId,
    })
    .select()
    .single()

  if (error) throw error

  revalidatePath('/dashboard')
  return data
}

export async function deletePost(postId: string) {
  const { userId } = auth()
  if (!userId) throw new Error('Unauthorized')

  const supabase = await createServerSupabaseClient()

  // RLSã«ã‚ˆã‚Šã€è‡ªåˆ†ã®æŠ•ç¨¿ã®ã¿å‰Šé™¤å¯èƒ½
  const { error } = await supabase
    .from('posts')
    .delete()
    .eq('id', postId)

  if (error) throw error

  revalidatePath('/dashboard')
}
```

---

# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½ã®å®Ÿè£…

## Supabase Realtimeã¨ã®çµ±åˆ

```typescript
'use client'

import { useEffect, useState } from 'react'
import { useSupabaseClient } from '@/lib/supabase/client'
import { useUser } from '@clerk/nextjs'

export function RealtimePosts() {
  const [posts, setPosts] = useState<Post[]>([])
  const supabase = useSupabaseClient()
  const { user } = useUser()

  useEffect(() => {
    if (!user) return

    // åˆæœŸãƒ‡ãƒ¼ã‚¿å–å¾—
    const fetchPosts = async () => {
      const { data } = await supabase
        .from('posts')
        .select('*')
        .order('created_at', { ascending: false })

      if (data) setPosts(data)
    }

    fetchPosts()

    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³
    const channel = supabase
      .channel('posts-changes')
      .on('postgres_changes',
        { event: '*', schema: 'public', table: 'posts' },
        (payload) => {
          if (payload.eventType === 'INSERT') {
            setPosts(prev => [payload.new as Post, ...prev])
          }
          if (payload.eventType === 'DELETE') {
            setPosts(prev => prev.filter(p => p.id !== payload.old.id))
          }
        }
      )
      .subscribe()

    return () => {
      supabase.removeChannel(channel)
    }
  }, [user, supabase])

  return (
    <div className="space-y-4">
      {posts.map(post => (
        <PostCard key={post.id} post={post} />
      ))}
    </div>
  )
}
```

---

# ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

## ã‚ˆãã‚ã‚‹çµ±åˆã‚¨ãƒ©ãƒ¼ã¨è§£æ±ºæ³•

### 1. JWTæ¤œè¨¼ã‚¨ãƒ©ãƒ¼
```
Error: JWT verification failed
```
**è§£æ±º**:
- Clerk Dashboardã§JWT Templateã‚’ç¢ºèª
- Supabase Dashboardã§JWT Secretã‚’ç¢ºèª

### 2. RLSãƒãƒªã‚·ãƒ¼ã‚¨ãƒ©ãƒ¼
```
Error: new row violates row-level security policy
```
**è§£æ±º**:
- `auth.jwt() ->> 'sub'`ãŒClerkã®user.idã¨ä¸€è‡´ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
- RLSãƒãƒªã‚·ãƒ¼ã®USINGå¥ã‚’ç¢ºèª

### 3. CORS ã‚¨ãƒ©ãƒ¼
**è§£æ±º**:
- Supabase URLãŒæ­£ã—ã„ã“ã¨ã‚’ç¢ºèª
- ç’°å¢ƒå¤‰æ•°ã«https://ã‚’å«ã‚ã‚‹

---

# Session 2 ã¾ã¨ã‚

## ã“ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§é”æˆã—ãŸã“ã¨

### âœ… ç†è«–çš„ç†è§£
- **èªè¨¼ã¨èªå¯ã®é•ã„**ã‚’å®Œå…¨ç†è§£
- **èªè¨¼ã‚’è‡ªä½œã™ã¹ãã§ãªã„ç†ç”±**ã‚’å­¦ç¿’
- **OAuth 2.0ã®ä»•çµ„ã¿**ã‚’ç†è§£

### âœ… å®Ÿè·µçš„ã‚¹ã‚­ãƒ«
- **Clerk + Googleèªè¨¼**ã®å®Ÿè£…å®Œäº†
- **Next.js 14 App Router**ã§ã®çµ±åˆ
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—ã¨æ´»ç”¨**æ–¹æ³•ç¿’å¾—

### âœ… ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ
- **Clerk + Supabaseçµ±åˆ**ãƒ‘ã‚¿ãƒ¼ãƒ³ç†è§£
- **JWTé€£æº**ã®ä»•çµ„ã¿æŠŠæ¡
- **RLSï¼ˆRow Level Securityï¼‰**ã¨ã®çµ±åˆæº–å‚™

---

# æ¬¡ã®Session 3-3ã¸

## çµ±åˆå®Ÿè£…ã«å‘ã‘ã¦

### ã“ã‚Œã‹ã‚‰å­¦ã¶ã“ã¨
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆ3-1ï¼‰ã¨èªè¨¼ï¼ˆ3-2ï¼‰ã®çµ±åˆ**
- **å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã®è©³ç´°**
- **å®¿é¡Œã‚¿ã‚¹ã‚¯ã®å…·ä½“çš„ãªé€²ã‚æ–¹**

### æº–å‚™ã§ããŸã“ã¨
- âœ… Supabaseãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹ç¯‰ï¼ˆ3-1ï¼‰
- âœ… Clerkèªè¨¼ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰ï¼ˆ3-2ï¼‰
- ğŸ”„ æ¬¡ã¯çµ±åˆå®Ÿè£…ã¸ï¼ˆ3-3ï¼‰

### é‡è¦ãƒã‚¤ãƒ³ãƒˆ
Session 3-3ã§ã¯ã€ä»Šã¾ã§å­¦ã‚“ã ãƒ‘ãƒ¼ãƒ„ã‚’
**ä¸€ã¤ã®å‹•ä½œã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**ã¨ã—ã¦
çµ±åˆã™ã‚‹æ–¹æ³•ã‚’å­¦ã³ã¾ã™

**ç¶šã„ã¦Session 3-3ã§å®Ÿè£…æ‰‹é †ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼**
---
title: "環境変数の本番設定"
track: "ライト版・第4回"
author: "TEKION Group / 泉水亮介"
last_updated: "2025年7月15日"
category: "デプロイ"
---

# 4-3 環境変数の本番設定

## 概要
前の章でアプリケーションをデプロイしましたが、おそらく認証やデータベース接続がうまく機能していないはずです。その原因は、APIキーなどの秘密情報が本番環境に設定されていないためです。この章では、`.env.local`の役割を再確認し、Vercel上で安全に本番用の環境変数を設定する方法を学びます。

## 学習目標
- 開発環境と本番環境で環境変数を使い分ける理由を理解する。
- `.env.local`ファイルがGitHubにアップロードされないことの重要性を再認識する。
- Vercelのダッシュボードで環境変数を設定し、アプリケーションに反映させる方法を習得する。
## なぜ環境変数を本番環境で設定する必要があるのか？

思い出してください。私たちはAPIキーのような秘密情報を `.env.local` というファイルに記述しました。そして、このファイルは `.gitignore` によって、**意図的にGitHubへアップロードされないように設定されています。**

```gitignore
# .gitignore の中身（一部）

# 環境変数
.env
.env.local
# ...
```

これは、第三者に知られてはいけない重要な情報（家の鍵のようなもの）を、パブリックな場所であるGitHubに置かないための、非常に重要なセキュリティ対策です。

VercelはGitHubのリポジトリからコードを取得してビルドするため、`.gitignore` に記載されている `.env.local` ファイルはVercelのサーバーにも存在しません。そのため、デプロイされたアプリケーションはAPIキーを知らず、外部サービス（ClerkやSupabase）に接続できないのです。

そこで、Vercelが提供する安全な方法で、本番環境専用の環境変数を設定する必要があります。

## ハンズオン：Vercelで環境変数を設定する

### ステップ1：必要な環境変数をリストアップする
まず、私たちのアプリケーションに必要な環境変数を確認します。`.env.local`ファイルを開き、リストアップしましょう。

- `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY`
- `CLERK_SECRET_KEY`
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`

### ステップ2：Vercelのダッシュボードで設定する
1.  Vercelのダッシュボードにログインし、デプロイしたプロジェクトを選択します。
2.  「Settings」タブをクリックし、左側のメニューから「Environment Variables」を選択します。
3.  リストアップしたキーと、対応する値を一つずつ入力していきます。
    - **KEY**: `.env.local`に記載されているキー名（例: `CLERK_SECRET_KEY`）を正確に入力します。
    - **VALUE**: ClerkやSupabaseのダッシュボードで取得した実際のキーの値を入力します。
    - `NEXT_PUBLIC_`で始まらないキー（例: `CLERK_SECRET_KEY`）は、より安全なサーバーサイド専用の変数として扱われます。
4.  全てのキーと値を設定し終えたら、「Save」をクリックします。

### ステップ3：再デプロイと動作確認
1.  環境変数を追加・変更すると、Vercelは通常、自動で新しいデプロイをトリガーします。
2.  もし自動で始まらない場合は、プロジェクトの「Deployments」タブに移動し、最新のデプロイの右側にある「...」メニューから「Redeploy」を選択します。
3.  デプロイが完了したら、再度公開URLにアクセスします。
4.  今度はAPIキーが正しく設定されているため、ログイン機能やデータベースとの通信が正常に動作することを確認しましょう。

## まとめ
これで、ローカル環境だけでなく、本番環境でも完全に動作するアプリケーションが完成しました。環境変数を適切に分離し、安全な方法で管理することは、プロの開発において非常に重要なスキルです。

次の章では、いよいよ最終成果発表会である「デモデイ」に向けて、どのような準備をすればよいかを解説します。
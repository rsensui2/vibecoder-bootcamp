---
title: "第3回 宿題説明"
track: "ライト版・第3回"
author: "TEKION Group / 泉水亮介"
last_updated: "2025年7月10日"
category: "宿題"
---

# 第3回 宿題説明

## 概要
第三回講義、お疲れ様でした！今回はデータベースの基礎からSupabaseの実践、そしてClerkを使った最新の認証方法まで、アプリケーションの根幹をなす重要なテーマを学びました。

この宿題では、これまでの講義で作成した「UIプロトタイプ」と「詳細設計書」に、今回学んだ「データベース」と「認証」を組み込み、ついに動的なWebアプリケーションを完成させることを目指します。

## 学習目標
- ClerkとSupabaseを連携させ、安全なユーザー認証付きアプリケーションを構築できる
- 認証状態に応じて、UIの表示を動的に切り替えることができる
- Server Actionsを使い、フロントエンドからデータベースへ安全にデータを保存できる
- データベースから取得したデータを画面に表示し、リアルタイム性を体験できる
- ローカル環境でアプリケーションを動作させ、AI駆動開発のサイクル（設計→実装→テスト）を一通り実践できる

## 課題内容

### 必須課題：認証付きSNSアプリケーションのMVP（Minimum Viable Product）を完成させる

第1回、第2回の宿題で作成したSNSアプリのUIと設計書を基に、以下の機能を実装してください。

#### ステップ1：環境構築とセットアップ
1.  **Next.jsプロジェクトの準備**:
    - 第二回の宿題で作成したプロジェクト、または新規に `create-next-app` でプロジェクトを作成します。
2.  **ライブラリのインストールと環境変数の設定**:
    - ClerkとSupabaseのプロジェクトを作成し、APIキーを取得しておきます。
    - 以下のプロンプトをAIに与え、必要な設定を一度に行ってもらいましょう。

**AIへのプロンプト例:**
```
Next.jsプロジェクトでClerkとSupabaseを使えるように設定してください。

1. 必要なライブラリをインストールします:
   - `@clerk/nextjs`
   - `@supabase/ssr`
   - `@supabase/supabase-js`
2. プロジェクトルートに`.env.local`ファイルを作成し、以下の環境変数を記述してください。値は後で自分で入力します。
   - `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY`
   - `CLERK_SECRET_KEY`
   - `NEXT_PUBLIC_SUPABASE_URL`
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
```

#### ステップ2：Clerkによる認証機能の実装
Clerkの認証機能を組み込みます。以下のプロンプトを使い、AIに必要なファイルとコードの生成を依頼しましょう。

**AIへのプロンプト例:**
```
Clerkの認証機能をNext.js App Routerのベストプラクティスに従って実装してください。

1. `app/layout.tsx` を開き、全体を `<ClerkProvider>` でラップしてください。日本語表示も有効にしてください。
2. プロジェクトのルートに `middleware.ts` を作成します。`clerkMiddleware` を使用し、トップページ(`/`)以外の全てのルートを保護する設定を記述してください。
3. `app/layout.tsx` のヘッダー部分に、ログイン状態に応じてUIを出し分ける機能を実装します。
   - ログイン時: `<UserButton />` を表示
   - ログアウト時: `<SignInButton />` を表示
```

#### ステップ3：Supabaseデータベースの準備
Supabaseのセットアップを行います。テーブル作成はダッシュボードで行い、RLSポリシーの設定はAIにSQLを生成してもらいましょう。

1.  **テーブル作成**:
    - Supabaseのダッシュボードにログインし、`users` と `posts` テーブルを設計書に基づいて作成します。
    - `users` テーブルには、ClerkのユーザーIDを保存する `clerk_id` (text型) カラムを追加します。
    - `posts` テーブルには、投稿者のIDを保存する `user_id` (uuid型) カラム（`users`テーブルへの外部キー）を追加します。
2.  **RLS (Row Level Security) の設定**:
    - SupabaseのSQL Editorで、以下のプロンプトをAIに与えて生成されたSQLを実行し、セキュリティポリシーを設定します。

**AIへのプロンプト例:**
```
SupabaseのRLSポリシーを作成するSQLを生成してください。

- postsテーブルに対するポリシー
  - SELECT: 全てのユーザーが閲覧可能
  - INSERT: ログインしているユーザーのみ許可
  - UPDATE: 自分の投稿(user_idがauth.uid()と一致)のみ許可
  - DELETE: 自分の投稿のみ許可
- usersテーブルに対するポリシー
  - SELECT: 全てのユーザーが閲覧可能
```

#### ステップ4：コア機能の実装
いよいよアプリケーションのコア機能を実装します。ここでもAIに具体的な指示を与えてコードを生成させます。

**AIへのプロンプト例:**
```
SNSのコア機能を実装します。

1. **投稿機能**:
   - 投稿フォームから内容を送信するためのServer Actionを作成してください。
   - Action内では、Clerkから現在のユーザーIDを取得し、そのユーザーIDと投稿内容をSupabaseの`posts`テーブルに保存します。
   - 投稿後はタイムラインページを再検証(revalidate)してください。
2. **タイムライン表示機能**:
   - トップページで、Supabaseの`posts`テーブルから投稿を全件取得し、新しい順に表示するコンポーネントを作成してください。
   - 各投稿には、投稿者のユーザー名とアイコンも関連付けて表示してください。
```

## 発展課題（余裕がある方向け）
- **いいね機能の実装**: `likes` テーブルを作成し、楽観的更新（useOptimistic）を使ってUIに即時反映させる。
- **プロフィールページの作成**: ログインユーザーが自分のプロフィール（名前など）を編集できるようにする。
- **Webhook連携**: Clerkで新規ユーザーが登録されたら、Webhookを使ってSupabaseの `users` テーブルに自動でユーザー情報を追加する。

## 提出について

**提出物：**
- **GitHubリポジトリのURL**

**提出方法：**
- SlackにてGitHubリポジトリのURLを共有してください。
- GitHubリポジトリには、**rsensui@tekion.jp** をインバイトしてください。

**提出期限：**
- 次回講義の前日まで

## 重要なマインドセット
- **AIはあなたの副操縦士**: 設計書（`requirements.yaml`など）をAIに読み込ませ、「この設計に基づいて実装して」と指示を出すのが基本です。
- **エラーは成長の糧**: エラーが出たら、その内容をそのままAIに貼り付けて解決策を聞きましょう。このプロセスが最も学びになります。
- **完璧を目指さない**: まずは動くもの（MVP）を作ることを最優先し、そこから改善を繰り返しましょう。

この宿題を通じて、アイデアから設計、そして実際に動くプロダクトまでを一気通貫で開発するVibe Coderとしての総合力を身につけていきましょう！
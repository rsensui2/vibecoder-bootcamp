---
title: "ãƒãƒ³ã‚ºã‚ªãƒ³: Clerkã«ã‚ˆã‚‹Googleèªè¨¼ã®å®Ÿè£…"
track: "ãƒ©ã‚¤ãƒˆç‰ˆãƒ»ç¬¬3å›"
author: "TEKION Group / æ³‰æ°´äº®ä»‹"
last_updated: "2025å¹´6æœˆ26æ—¥"
category: "èªè¨¼"
---

# ãƒãƒ³ã‚ºã‚ªãƒ³: Clerkã«ã‚ˆã‚‹Googleèªè¨¼ã®å®Ÿè£…

## æ¦‚è¦
å‰ã®ãƒ¦ãƒ‹ãƒƒãƒˆã§å­¦ã‚“ã èªè¨¼ã®ç†è«–ã‚’ã€ã„ã‚ˆã„ã‚ˆå®Ÿè·µã«ç§»ã—ã¾ã™ã€‚ã“ã®ãƒ¦ãƒ‹ãƒƒãƒˆã§ã¯ã€ã‚ãªãŸã®Next.jsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã€**Clerk**ã¨ã„ã†å¼·åŠ›ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ã£ã¦ã€é«˜æ©Ÿèƒ½ãªã€ŒGoogleèªè¨¼ã€ã‚’å°å…¥ã—ã¾ã™ã€‚

ä¸€ã¤ä¸€ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’ã€ãªãœãã†ã™ã‚‹ã®ã‹ã¨ã„ã†ç†ç”±ã¨å…±ã«ã€ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆä»˜ãã§ä¸å¯§ã«è§£èª¬ã—ã¾ã™ã€‚ç„¦ã‚‰ãšã¤ã„ã¦ãã¦ãã ã•ã„ã€‚ã“ã®ãƒãƒ³ã‚ºã‚ªãƒ³ãŒçµ‚ã‚ã‚‹é ƒã«ã¯ã€ã‚ãªãŸã®ã‚¢ãƒ—ãƒªã¯ãƒ—ãƒ­ãƒ¬ãƒ™ãƒ«ã®èªè¨¼æ©Ÿèƒ½ã‚’é©šãã»ã©ç°¡å˜ã«æ‰‹ã«å…¥ã‚Œã¦ã„ã¾ã™ã€‚

## ã“ã®ç« ã®ã‚´ãƒ¼ãƒ«ã¨é”æˆç›®æ¨™
ã“ã®ç« ã‚’çµ‚ãˆã‚‹ã¨ã€ã‚ãªãŸã¯ä»¥ä¸‹ã®ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

- **ã‚´ãƒ¼ãƒ«:** Clerkã¨Google Cloud Consoleã‚’é€£æºã•ã›ã€Next.jsã‚¢ãƒ—ãƒªã«å®‰å…¨ãªGoogleãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã‚’å®Ÿè£…ã§ãã‚‹ã€‚
- **é”æˆç›®æ¨™:**
    1. Clerkã®å½¹å‰²ã¨ã€ãã‚ŒãŒèªè¨¼ã®è¤‡é›‘ã•ã‚’ã©ã®ã‚ˆã†ã«è§£æ±ºã—ã¦ãã‚Œã‚‹ã®ã‹ã‚’èª¬æ˜ã§ãã‚‹ã€‚
    2. Clerkã®UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ã„ã“ãªã—ã€ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã«å¿œã˜ã¦è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹å®Ÿè£…ãŒã§ãã‚‹ã€‚
    3. Google Cloud Consoleã§OAuthã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’ç™ºè¡Œã—ã€ãã®è¨­å®šå€¤ã®æ„å‘³ã‚’ç†è§£ã§ãã‚‹ã€‚
    4. ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ã‚’å®‰å…¨ã«å–å¾—ã™ã‚‹æ–¹æ³•ã‚’ç†è§£ã—ã€å®Ÿè£…ã§ãã‚‹ã€‚

## æº–å‚™
- [3-3.èªè¨¼ã«ã¤ã„ã¦.md](./3-3.èªè¨¼ã«ã¤ã„ã¦.md)ã‚’èª­ã¿çµ‚ãˆã¦ã„ã‚‹ã“ã¨ã€‚
- Clerkã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãŠãã“ã¨ã€‚
- Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æŒã£ã¦ã„ã‚‹ã“ã¨ã€‚

---

## 1. Clerkã®å½¹å‰²ã¨èªè¨¼ãƒ•ãƒ­ãƒ¼ã®å…¨ä½“åƒ

ãƒãƒ³ã‚ºã‚ªãƒ³ã«å…¥ã‚‹å‰ã«ã€ClerkãŒç§ãŸã¡ã®é–‹ç™ºã‚’ã©ã‚Œã ã‘æ¥½ã«ã—ã¦ãã‚Œã‚‹ã®ã‹ã€ãã®å…¨ä½“åƒã‚’æ´ã‚“ã§ãŠãã¾ã—ã‚‡ã†ã€‚

### ClerkãŒéš è”½ã—ã¦ãã‚Œã‚‹OAuthã®è¤‡é›‘ã•

å‰ã®ãƒ¦ãƒ‹ãƒƒãƒˆã§å­¦ã‚“ã OAuthã®ãƒ•ãƒ­ãƒ¼ã‚’æ€ã„å‡ºã—ã¦ãã ã•ã„ã€‚èªè¨¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã€ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã€èªå¯ã‚³ãƒ¼ãƒ‰ã®å–å¾—ã€ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®äº¤æ›ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—...ã€‚ã“ã‚Œã‚‰å…¨ã¦ã‚’è‡ªå‰ã§å®Ÿè£…ã™ã‚‹ã®ã¯éå¸¸ã«å¤§å¤‰ã§ã™ã€‚

Clerkã¯ã€ã“ã®ä¸€é€£ã®é¢å€’ãªå‡¦ç†ã‚’å…¨ã¦è‚©ä»£ã‚ã‚Šã—ã¦ãã‚Œã¾ã™ã€‚ç§ãŸã¡ãŒã‚„ã‚‹ã¹ãã“ã¨ã¯ã€ClerkãŒæä¾›ã™ã‚‹ä¾¿åˆ©ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ•°è¡Œã‚³ãƒ¼ãƒ‰ã«è¿½åŠ ã™ã‚‹ã ã‘ã§ã™ã€‚

- **`<ClerkProvider>`**: ã‚¢ãƒ—ãƒªå…¨ä½“ã«ã€Œä»Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ã‹ï¼Ÿã€ã¨ã„ã†æƒ…å ±ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã®å¤§å…ƒã§ã™ã€‚
- **`<SignInButton>` / `<UserButton>`**: ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ä»˜ãã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã€é©šãã»ã©ç°¡å˜ã«è¡¨ç¤ºã—ã¦ãã‚Œã¾ã™ã€‚
- **`middleware.ts`**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã€Œæ¤œå•æ‰€ã€ã¨ã—ã¦æ©Ÿèƒ½ã—ã€æœªãƒ­ã‚°ã‚¤ãƒ³ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è‡ªå‹•çš„ã«ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«èª˜å°ã—ã¦ãã‚Œã¾ã™ã€‚

ã“ã‚Œã‚‰ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã€è£å´ã§OAuthã®è¤‡é›‘ãªã‚„ã‚Šå–ã‚Šã‚’å…¨ã¦å®Ÿè¡Œã—ã¦ãã‚Œã¦ã„ã‚‹ã®ã§ã™ã€‚

### Clerkå°å…¥å¾Œã®èªè¨¼ãƒ•ãƒ­ãƒ¼

Mermaid.jsã‚’ä½¿ã£ã¦ã€Clerkã‚’å°å…¥ã—ãŸéš›ã®èªè¨¼ãƒ•ãƒ­ãƒ¼ã‚’å›³è§£ã—ã¾ã™ã€‚

```mermaid
sequenceDiagram
    participant User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant App as Next.jsã‚¢ãƒ—ãƒª
    participant Clerk as Clerkã‚µãƒ¼ãƒãƒ¼
    participant Google as Googleèªè¨¼ã‚µãƒ¼ãƒãƒ¼

    User->>App: ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
    App->>Clerk: èªè¨¼é–‹å§‹ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    Clerk-->>User: Googleã®ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
    User->>Google: Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³
    Google-->>User: èªå¯ã‚³ãƒ¼ãƒ‰ã¨å…±ã«Clerkã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
    User-->>Clerk: èªå¯ã‚³ãƒ¼ãƒ‰ã‚’æ¸¡ã™
    Clerk->>Google: èªå¯ã‚³ãƒ¼ãƒ‰ã‚’ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã¨äº¤æ›
    Google->>Clerk: ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œ
    Clerk->>Google: ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    Google->>Clerk: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’æ¸¡ã™
    Clerk-->>User: èªè¨¼å®Œäº†ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç™ºè¡Œã—ã‚¢ãƒ—ãƒªã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
    User-->>App: èªè¨¼æ¸ˆã¿çŠ¶æ…‹ã§ã‚¢ã‚¯ã‚»ã‚¹
    App->>Clerk: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ç¢ºèª
    Clerk->>App: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’æ¸¡ã™
    App-->>User: ãƒ­ã‚°ã‚¤ãƒ³å¾Œã®ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤º (ä¾‹: ã‚ˆã†ã“ãã€ã€‡ã€‡ã•ã‚“ï¼)
```
ã“ã®å›³ã®ã€ŒClerkã€ã¨ã€ŒGoogleã€é–“ã®è¤‡é›‘ãªã‚„ã‚Šå–ã‚Šã‚’ã€ClerkãŒå…¨ã¦æ‹…å½“ã—ã¦ãã‚Œã¾ã™ã€‚é–‹ç™ºè€…ã¯ã€ŒAppã€ã¨ã€ŒClerkã€ã®é€£æºéƒ¨åˆ†ã ã‘ã‚’è€ƒãˆã‚Œã°è‰¯ã„ã®ã§ã™ã€‚

---

## 2. Clerkã®åˆæœŸè¨­å®š (ãƒãƒ³ã‚ºã‚ªãƒ³)

### ã‚¹ãƒ†ãƒƒãƒ—1: Clerkã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆ
1.  Clerkã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã€ã€ŒAdd applicationã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
2.  å¥½ããªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åã‚’å…¥åŠ›ã—ã¾ã™ã€‚
3.  èªè¨¼æ–¹æ³•ã¨ã—ã¦ã€ŒGoogleã€ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã€ã€ŒCreate Applicationã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
4.  ä½œæˆãŒå®Œäº†ã™ã‚‹ã¨ã€APIã‚­ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚**ã“ã®ãƒšãƒ¼ã‚¸ã¯ã¾ã é–‰ã˜ãªã„ã§ãã ã•ã„ã€‚**

### ã‚¹ãƒ†ãƒƒãƒ—2: Next.jsã¸ã®SDKã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ç’°å¢ƒå¤‰æ•°è¨­å®š

**â–¶ Cursorã¸ã®æŒ‡ç¤º (ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹)**
> Next.jsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§Clerkã‚’ä½¿ã„ãŸã„ã€‚
> 1. å¿…è¦ãªå…¬å¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã€‚
> 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«`.env.local`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®ã‚­ãƒ¼ã‚’è¿½åŠ ã—ã¦ã€‚å€¤ã¯å¾Œã§è‡ªåˆ†ã§å…¥ã‚Œã¾ã™ã€‚
>    - `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY`
>    - `CLERK_SECRET_KEY`

CursorãŒä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ãã‚Œã¾ã™ã€‚
```bash
npm install @clerk/nextjs
```

```.env.local
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=""
CLERK_SECRET_KEY=""
```
å…ˆã»ã©é–‹ã„ãŸã¾ã¾ã®Clerkã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰ã€å¯¾å¿œã™ã‚‹ã‚­ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦è²¼ã‚Šä»˜ã‘ã¾ã™ã€‚

> #### ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ
> `.env.local`ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€çµ¶å¯¾ã«Gitã§ç®¡ç†ã—ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚„APIã‚­ãƒ¼ãªã©ã€çµ¶å¯¾ã«æ¼æ´©ã—ã¦ã¯ãªã‚‰ãªã„ç§˜å¯†æƒ…å ±ãŒå«ã¾ã‚Œã¾ã™ã€‚
> Next.jsã®æ¨™æº–çš„ãª`.gitignore`ã«ã¯`.env.local`ãŒå«ã¾ã‚Œã¦ã„ã‚‹ãŸã‚ã€é€šå¸¸ã¯å•é¡Œã‚ã‚Šã¾ã›ã‚“ãŒã€èª¤ã£ã¦`git add -f .env.local`ã®ã‚ˆã†ãªã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ãªã„ã‚ˆã†ã€ç´°å¿ƒã®æ³¨æ„ã‚’æ‰•ã„ã¾ã—ã‚‡ã†ã€‚ã‚­ãƒ¼ã®æ¼æ´©ã¯ã€æ·±åˆ»ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã«ç¹‹ãŒã‚Šã¾ã™ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—3: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®Providerè¨­å®š

Clerkã®æ©Ÿèƒ½ã‚’ã‚¢ãƒ—ãƒªå…¨ä½“ã§ä½¿ãˆã‚‹ã‚ˆã†ã«ã€`layout.tsx`ã‚’`<ClerkProvider>`ã§å›²ã¿ã¾ã™ã€‚

**â–¶ Cursorã¸ã®æŒ‡ç¤º (ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹)**
> `app/layout.tsx`ã‚’é–‹ã„ã¦ã€`<html>`ã¨`<body>`ã‚¿ã‚°ã‚’`<ClerkProvider>`ã§ãƒ©ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚

```tsx:app/layout.tsx
import { ClerkProvider } from '@clerk/nextjs'
import { jaJP } from "@clerk/localizations"; // æ—¥æœ¬èªåŒ–ã®ãŸã‚ã«è¿½åŠ 

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    // ClerkProviderã§å…¨ä½“ã‚’å›²ã‚€
    <ClerkProvider localization={jaJP}> {/* æ—¥æœ¬èªåŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³ */}
      <html lang="ja">
        <body>{children}</body>
      </html>
    </ClerkProvider>
  )
}
```
**ãƒã‚¤ãƒ³ãƒˆ:** `jaJP`ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦`localization`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«æ¸¡ã™ã“ã¨ã§ã€ClerkãŒæä¾›ã™ã‚‹UIï¼ˆã‚µã‚¤ãƒ³ã‚¤ãƒ³ç”»é¢ãªã©ï¼‰ãŒè‡ªå‹•çš„ã«æ—¥æœ¬èªã«ãªã‚Šã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã®ç°¡å˜ãªä¸€æ‰‹é–“ã§ã™ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—4: ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®ä½œæˆ

èªè¨¼æƒ…å ±ã‚’ä¿è­·ã—ã€ã©ã®ãƒšãƒ¼ã‚¸ã‚’å…¬é–‹ã—ã€ã©ã®ãƒšãƒ¼ã‚¸ã‚’èªè¨¼å¿…é ˆã«ã™ã‚‹ã‹ã‚’ä¸€å…ƒç®¡ç†ã™ã‚‹ã€ŒãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã€ã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã‚Œã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã®ã€Œæ¤œå•æ‰€ã€ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚

**â–¶ Cursorã¸ã®æŒ‡ç¤º (ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹)**
> ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆ`app`ãƒ•ã‚©ãƒ«ãƒ€ã¨åŒã˜éšå±¤ï¼‰ã«`middleware.ts`ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
> ä¸­èº«ã¯ã€Clerkã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ã‚‹åŸºæœ¬çš„ãªè¨­å®šã‚’è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚å…¨ã¦ã®ãƒ«ãƒ¼ãƒˆã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ä¿è­·ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```typescript:middleware.ts
import { authMiddleware } from "@clerk/nextjs/server";

export default authMiddleware({
  // publicRoutes: ["/about", "/contact"], // ä¾‹: /about ã¨ /contact ã¯ãƒ­ã‚°ã‚¤ãƒ³ä¸è¦ã§å…¬é–‹
});

export const config = {
  matcher: ["/((?!.*\\..*|_next).*)", "/", "/(api|trpc)(.*)"],
};
```

#### `matcher`ã®è§£èª¬
ã“ã®æ­£è¦è¡¨ç¾ã¯å°‘ã—è¤‡é›‘ã«è¦‹ãˆã¾ã™ãŒã€ã€Œã©ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ˆæ¤œå•æ‰€ï¼‰ã§ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã‹ã€ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚
- `"/((?!.*\\..*|_next).*)"`: `_next`ï¼ˆNext.jsã®å†…éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã‚„`.`ï¼ˆç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ãªã©ï¼‰ã‚’å«ã¾ãªã„ã€ã»ã¨ã‚“ã©ã®ãƒšãƒ¼ã‚¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ãƒãƒƒãƒã—ã¾ã™ã€‚
    - ä¾‹: `/dashboard`, `/profile/settings` â†’ **ãƒãƒƒãƒã™ã‚‹**
    - ä¾‹: `/_next/static/style.css`, `/favicon.ico` â†’ **ãƒãƒƒãƒã—ãªã„**
- `"/"`: ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«ãƒãƒƒãƒã—ã¾ã™ã€‚
- `"/(api|trpc)(.*)"`: `/api/`ã‚„`/trpc/`ã§å§‹ã¾ã‚‹APIãƒ«ãƒ¼ãƒˆã«ãƒãƒƒãƒã—ã¾ã™ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’å¦¨ã’ã‚‹ã“ã¨ãªãã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒšãƒ¼ã‚¸ã¨APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’åŠ¹ç‡çš„ã«ä¿è­·ã§ãã¾ã™ã€‚

---

## 3. Googleèªè¨¼ã®æœ‰åŠ¹åŒ– (ãƒãƒ³ã‚ºã‚ªãƒ³)

ã“ã“ãŒä¸€ç•ªã®å±±å ´ã§ã™ãŒã€å„è¨­å®šã®æ„å‘³ã‚’ç†è§£ã™ã‚Œã°æ€–ãã‚ã‚Šã¾ã›ã‚“ã€‚ä¸€ã¤ãšã¤ä¸å¯§ã«é€²ã‚ã¾ã—ã‚‡ã†ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—5: Google Cloud Consoleã§ã®èªè¨¼æƒ…å ±ä½œæˆ

1.  [Google Cloud Console](https://console.cloud.google.com/)ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚ï¼ˆæ—¢å­˜ã®ã‚‚ã®ã§ã‚‚OKï¼‰
2.  å·¦ä¸Šã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€ŒAPIã¨ã‚µãƒ¼ãƒ“ã‚¹ã€>ã€Œ**OAuthåŒæ„ç”»é¢**ã€ã‚’é¸æŠã—ã¾ã™ã€‚
    -   **ãªãœã“ã‚ŒãŒå¿…è¦ï¼Ÿ**: ã‚ãªãŸã®ã‚¢ãƒ—ãƒªãŒã€Œã€‡ã€‡ã•ã‚“ã®Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ï¼ˆåå‰ã‚„ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã•ã›ã¦ãã ã•ã„ã€ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãŠé¡˜ã„ã™ã‚‹éš›ã«è¡¨ç¤ºã•ã‚Œã‚‹åŒæ„ç”»é¢ã®æƒ…å ±ã§ã™ã€‚ã‚¢ãƒ—ãƒªåã‚„ã‚µãƒãƒ¼ãƒˆãƒ¡ãƒ¼ãƒ«ã‚’æ­£ã—ãè¨­å®šã™ã‚‹ã“ã¨ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å®‰å¿ƒæ„Ÿã‚’ä¸ãˆã¾ã™ã€‚
    -   **User Type**: ã€Œå¤–éƒ¨ã€ã‚’é¸æŠã—ã¾ã™ã€‚ï¼ˆGCPçµ„ç¹”ã«å±ã—ã¦ã„ãªã„é™ã‚Šã€ã“ã‚Œã‚’é¸æŠã—ã¾ã™ï¼‰
    -   ã‚¢ãƒ—ãƒªåã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒãƒ¼ãƒˆãƒ¡ãƒ¼ãƒ«ã€ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ã®é€£çµ¡å…ˆæƒ…å ±ã‚’å…¥åŠ›ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚ã‚¹ã‚³ãƒ¼ãƒ—ã‚„ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¨­å®šã¯ã€ã“ã®æ®µéšã§ã¯ä¸è¦ã§ã™ã€‚
3.  æ¬¡ã«ã€å·¦ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€Œ**èªè¨¼æƒ…å ±**ã€ã‚’é¸æŠã—ã¾ã™ã€‚
4.  ç”»é¢ä¸Šéƒ¨ã®ã€Œï¼‹èªè¨¼æƒ…å ±ã‚’ä½œæˆã€>ã€Œ**OAuth 2.0 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID**ã€ã‚’é¸æŠã—ã¾ã™ã€‚
    -   **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¨®é¡**: ã€Œã‚¦ã‚§ãƒ– ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚’é¸æŠã—ã¾ã™ã€‚
    -   **åå‰**: å¥½ããªåå‰ï¼ˆä¾‹: VibeCoderApp Authï¼‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚
    -   **æ‰¿èªæ¸ˆã¿ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URI**: **ã“ã“ãŒæœ€ã‚‚é‡è¦ã§ã™ã€‚**
        -   **ãªãœã“ã‚ŒãŒå¿…è¦ï¼Ÿ**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®è¦ã§ã™ã€‚Googleã§ã®èªè¨¼ãŒæˆåŠŸã—ãŸå¾Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’**å®‰å…¨ã«ã‚ãªãŸã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«æˆ»ã™ãŸã‚**ã®ã€Œæˆ»ã‚Šå…ˆä½æ‰€ã€ã‚’Googleã«äº‹å‰ç™»éŒ²ã—ã¦ãŠãä»•çµ„ã¿ã§ã™ã€‚ã‚‚ã—ã“ã‚ŒãŒãªã‘ã‚Œã°ã€æ‚ªæ„ã®ã‚ã‚‹ã‚µã‚¤ãƒˆãŒãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆã‚’å½è£…ã—ã€èªè¨¼æƒ…å ±ã‚’ç›—ã¿å–ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚
        -   **è¨­å®šæ–¹æ³•**: Clerkã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚Šã€ã€ŒProvidersã€>ã€ŒGoogleã€ã®è¨­å®šç”»é¢ã«ã‚ã‚‹ã€ŒRedirect URIã€ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€Google Cloud Consoleã®ã€ŒURIã‚’è¿½åŠ ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã€è²¼ã‚Šä»˜ã‘ã¾ã™ã€‚
5.  ã€Œä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ã€Œ**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID**ã€ã¨ã€Œ**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ**ã€ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
    -   **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID**: ã‚ãªãŸã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è­˜åˆ¥ã™ã‚‹ãŸã‚ã®å…¬é–‹ã•ã‚ŒãŸIDã§ã™ã€‚ã€Œè¡¨æœ­ã€ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚
    -   **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã ã‘ãŒçŸ¥ã£ã¦ã„ã‚‹ç§˜å¯†ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ã™ã€‚ã€Œåˆéµã€ã®ã‚ˆã†ãªã‚‚ã®ã§ã€çµ¶å¯¾ã«æ¼æ´©ã•ã›ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚

> #### ğŸ”§ ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼: `redirect_uri_mismatch`
> ã“ã®ã‚¨ãƒ©ãƒ¼ã¯ã€Googleèªè¨¼ã‚’è¨­å®šã™ã‚‹éš›ã«æœ€ã‚‚ã‚ˆãé­é‡ã™ã‚‹å•é¡Œã§ã™ã€‚
> - **åŸå› **: Google Cloud Consoleã«ç™»éŒ²ã—ãŸã€Œæ‰¿èªæ¸ˆã¿ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIã€ã¨ã€å®Ÿéš›ã«ClerkãŒGoogleã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ã„ã‚‹ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIãŒä¸€è‡´ã—ã¦ã„ãªã„å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚
> - **è§£æ±ºç­–**:
>     1. Clerkã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã€ŒRedirect URIã€ã‚’æ­£ç¢ºã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚ï¼ˆæœ«å°¾ã®ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã®æœ‰ç„¡ãªã©ã‚‚å«ã‚ã¦å®Œå…¨ã«ä¸€è‡´ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼‰
>     2. Google Cloud Consoleã®ã€Œèªè¨¼æƒ…å ±ã€> å¯¾è±¡ã®OAuthã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’ç·¨é›† > ã€Œæ‰¿èªæ¸ˆã¿ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIã€ã«ã€ã‚³ãƒ”ãƒ¼ã—ãŸURIãŒæ­£ã—ãç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‹å†ç¢ºèªã—ã¾ã™ã€‚
>     3. è¤‡æ•°ã®URIãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ä¸è¦ãªã‚‚ã®ãŒãªã„ã‹ç¢ºèªã—ã¾ã™ã€‚
>
> ã»ã¨ã‚“ã©ã®å ´åˆã€ã“ã®æ‰‹é †ã§è§£æ±ºã—ã¾ã™ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—6: Clerkã¸ã®ã‚­ãƒ¼è¨­å®š

1.  Clerkã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚Šã¾ã™ã€‚
2.  ã€ŒProvidersã€>ã€ŒGoogleã€ã®è¨­å®šç”»é¢ã‚’é–‹ãã¾ã™ã€‚
3.  å…ˆã»ã©Google Cloud Consoleã§å–å¾—ã—ãŸã€Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã€ã¨ã€Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã€ã‚’ãã‚Œãã‚Œå¯¾å¿œã™ã‚‹æ¬„ã«è²¼ã‚Šä»˜ã‘ã€ã€ŒSaveã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

ã“ã‚Œã§ã€ã‚ãªãŸã®ã‚¢ãƒ—ãƒªã§Googleèªè¨¼ã‚’ä½¿ã†ãŸã‚ã®å…¨ã¦ã®æº–å‚™ãŒæ•´ã„ã¾ã—ãŸï¼

---

## 4. UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å®Ÿè£…ã¨æ´»ç”¨ (ãƒãƒ³ã‚ºã‚ªãƒ³)

æœ€å¾Œã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå®Ÿéš›ã«æ“ä½œã™ã‚‹UIã‚’è¨­ç½®ã—ã€ã‚ˆã‚Šå®Ÿè·µçš„ãªä½¿ã„æ–¹ã‚’å­¦ã³ã¾ã™ã€‚

### åŸºæœ¬çš„ãªãƒ­ã‚°ã‚¤ãƒ³/ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ã®è¨­ç½®

**â–¶ Cursorã¸ã®æŒ‡ç¤º (ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹)**
> `app/layout.tsx`ã«ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
> ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã¯ã€Clerkã‚’ä½¿ã£ã¦ã€
> - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã„æ™‚ã¯ã€Œã‚µã‚¤ãƒ³ã‚¤ãƒ³ã€ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
> - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹æ™‚ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆãƒ­ã‚°ã‚¢ã‚¦ãƒˆãªã©ï¼‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
> ã™ã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚

Cursorã¯`<SignedOut>`, `<SignedIn>`, `<SignInButton>`, `<UserButton>`ã¨ã„ã£ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’é§†ä½¿ã—ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```tsx:app/layout.tsx
// ... (æ—¢å­˜ã®imports)
import { SignedIn, SignedOut, SignInButton, UserButton } from '@clerk/nextjs'

export default function RootLayout({ children }) {
  return (
    <ClerkProvider localization={jaJP}>
      <html lang="ja">
        <body>
          <header style={{ display: 'flex', justifyContent: 'space-between', padding: '1rem', borderBottom: '1px solid #ccc' }}>
            <h1>VibeCoder App</h1>
            <div>
              <SignedOut>
                <SignInButton />
              </SignedOut>
              <SignedIn>
                <UserButton afterSignOutUrl="/" />
              </SignedIn>
            </div>
          </header>
          <main style={{ padding: '1rem' }}>{children}</main>
        </body>
      </html>
    </ClerkProvider>
  )
}
```
- **`<SignedOut>`**: ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§å›²ã¾ã‚ŒãŸè¦ç´ ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ**ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¦ã„ã‚‹æ™‚ã ã‘**è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
- **`<SignedIn>`**: ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§å›²ã¾ã‚ŒãŸè¦ç´ ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ**ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹æ™‚ã ã‘**è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
- **`<UserButton afterSignOutUrl="/" />`**: ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå¾Œã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆã‚’æŒ‡å®šã§ãã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’å‘ä¸Šã•ã›ã‚‹é‡è¦ãªè¨­å®šã§ã™ã€‚

### ã€å¿œç”¨ã€‘å®Ÿè·µçš„ãªUIã®å‡ºã—åˆ†ã‘

`<SignedIn>`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€ã‚ˆã‚Šå®Ÿè·µçš„ãªUIã®åˆ¶å¾¡ã«ã‚‚ä½¿ãˆã¾ã™ã€‚ä¾‹ãˆã°ã€ã€Œãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã ã‘æŠ•ç¨¿ãƒœã‚¿ãƒ³ã‚’è¦‹ã›ã‚‹ã€ã¨ã„ã£ãŸå®Ÿè£…ãŒç°¡å˜ã«ã§ãã¾ã™ã€‚

```tsx:app/page.tsx
import { SignedIn, SignedOut } from '@clerk/nextjs';

function PostButton() {
  return <button>æŠ•ç¨¿ã™ã‚‹</button>;
}

export default function HomePage() {
  return (
    <div>
      <h2>ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</h2>
      <SignedIn>
        {/* ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯æŠ•ç¨¿ãƒœã‚¿ãƒ³ã¨æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ ãŒè¦‹ãˆã‚‹ */}
        <div style={{ marginBottom: '1rem' }}>
          <textarea placeholder="ã„ã¾ã©ã†ã—ã¦ã‚‹ï¼Ÿ" style={{ width: '100%', minHeight: '80px' }} />
          <PostButton />
        </div>
      </SignedIn>
      <SignedOut>
        {/* ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯ã€ãƒ­ã‚°ã‚¤ãƒ³ã‚’ä¿ƒã™ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¦‹ãˆã‚‹ */}
        <p>æŠ•ç¨¿ã™ã‚‹ã«ã¯<a href="/sign-in">ãƒ­ã‚°ã‚¤ãƒ³</a>ã—ã¦ãã ã•ã„ã€‚</p>
      </SignedOut>
      {/* ...æŠ•ç¨¿ä¸€è¦§... */}
    </div>
  );
}
```

### ã€å¿œç”¨ã€‘ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã™ã‚‹

UIã ã‘ã§ãªãã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’åˆ©ç”¨ã—ãŸã„å ´é¢ã¯å¤šãã‚ã‚Šã¾ã™ï¼ˆä¾‹: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’è¨˜éŒ²ã™ã‚‹ï¼‰ã€‚Clerkã§ã¯ã€ã“ã‚Œã‚‚éå¸¸ã«ç°¡å˜ã§ã™ã€‚

`@clerk/nextjs/server`ã‹ã‚‰`auth`ã‚„`currentUser`ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ä½¿ã„ã¾ã™ã€‚

```tsx:app/page.tsx
import { auth, currentUser } from '@clerk/nextjs/server';

export default async function HomePage() {
  // auth() ã‚’ä½¿ã£ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚„ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã‚’å–å¾—
  const { userId } = auth();
  
  // currentUser() ã‚’ä½¿ã£ã¦ã€ã‚ˆã‚Šè©³ç´°ãªãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
  const user = await currentUser();

  return (
    <div>
      <h2>ã‚ˆã†ã“ãï¼</h2>
      {user ? (
        <p>ã“ã‚“ã«ã¡ã¯ã€{user.firstName || user.username}ã•ã‚“ï¼ ã‚ãªãŸã®IDã¯ `{userId}` ã§ã™ã€‚</p>
      ) : (
        <p>ã‚²ã‚¹ãƒˆã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼</p>
      )}
      {/* ...ãã®ä»–ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„... */}
    </div>
  );
}
```
- **`auth()`**: ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚„APIãƒ«ãƒ¼ãƒˆã§ã€ç¾åœ¨ã®èªè¨¼çŠ¶æ…‹ï¼ˆ`userId`ãªã©ï¼‰ã‚’ç´ æ—©ãå–å¾—ã™ã‚‹ã®ã«ä¾¿åˆ©ã§ã™ã€‚
- **`currentUser()`**: ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒãªã©ã€ã‚ˆã‚Šãƒªãƒƒãƒãªãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã—ãŸã„å ´åˆã«ä½¿ã„ã¾ã™ã€‚ã“ã‚Œã¯éåŒæœŸé–¢æ•°ã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

### å‹•ä½œç¢ºèª
`npm run dev`ã§é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
- å³ä¸Šã«ã€Œã‚µã‚¤ãƒ³ã‚¤ãƒ³ã€ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚
- ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ClerkãŒæä¾›ã™ã‚‹ç¾ã—ã„ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒé–‹ãã€ã€ŒGoogleã§ç¶šè¡Œã€ãƒœã‚¿ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚
- ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã¨ã€ãƒœã‚¿ãƒ³ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ã€‚
- ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†ã‚„ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãŒã§ãã¾ã™ã€‚
- ãƒšãƒ¼ã‚¸ã«ã¯ã€Œã“ã‚“ã«ã¡ã¯ã€ã€‡ã€‡ã•ã‚“ï¼ã€ã®ã‚ˆã†ã«ã€ã‚ãªãŸã®Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆåãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚

---

## 5. æ¼”ç¿’èª²é¡Œ

### èª²é¡Œ1 (Essentialsãƒ—ãƒ©ãƒ³)
1.  ã‚ãªãŸã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã€ã“ã®ãƒ¦ãƒ‹ãƒƒãƒˆã§å­¦ã‚“ã æ–¹æ³•ã§Googleãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚
2.  ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸(`/`)ã¯ãƒ­ã‚°ã‚¤ãƒ³ã—ãªãã¦ã‚‚è¦‹ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã€`middleware.ts`ã®`publicRoutes`ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚
    ```typescript:middleware.ts
    export default authMiddleware({
      publicRoutes: ["/"],
    });
    ```
3.  ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹æ™‚ã ã‘ã€Œãƒã‚¤ãƒšãƒ¼ã‚¸ã€ã¨ã„ã†ãƒªãƒ³ã‚¯ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ã€`layout.tsx`ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚

### èª²é¡Œ2 (Transformationãƒ—ãƒ©ãƒ³)
1.  Clerkã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã€Googleä»¥å¤–ã®èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼ˆä¾‹: GitHubï¼‰ã‚’æœ‰åŠ¹åŒ–ã—ã€ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«ãƒœã‚¿ãƒ³ãŒè¿½åŠ ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ï¼ˆã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã¯ä¸è¦ã§ã™ï¼ï¼‰
2.  ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®**ãƒ¦ãƒ¼ã‚¶ãƒ¼ID (`userId`)** ã‚’ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§å–å¾—ã—ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤ºã•ã›ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
3.  **ç™ºå±•:** ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã ã‘ãŒè¦‹ã‚‰ã‚Œã‚‹`/dashboard`ã¨ã„ã†ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚ã“ã®ãƒšãƒ¼ã‚¸ã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ï¼ˆ`middleware.ts`ã®`publicRoutes`ã«`/dashboard`ã‚’è¿½åŠ ã—ãªã„ã“ã¨ãŒãƒã‚¤ãƒ³ãƒˆã§ã™ï¼‰

## ã¾ã¨ã‚
ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼ã‚ãªãŸã¯ä»Šã€è‡ªåŠ›ã§ã€å®‰å…¨ã‹ã¤é«˜æ©Ÿèƒ½ãªGoogleèªè¨¼ã‚’ã‚¢ãƒ—ãƒªã«çµ„ã¿è¾¼ã‚€ã‚¹ã‚­ãƒ«ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ãŸã€‚æ‰‹ä½œæ¥­ã®å¤šã•ã«é©šã„ãŸã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ã“ã‚Œã¯ä¸€åº¦è¨­å®šã™ã‚Œã°çµ‚ã‚ã‚Šã§ã™ã€‚

ClerkãŒã„ã‹ã«èªè¨¼ã®è¤‡é›‘ãªéƒ¨åˆ†ã‚’æŠ½è±¡åŒ–ã—ã€é–‹ç™ºè€…ãŒæœ¬æ¥é›†ä¸­ã™ã¹ãã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¾¡å€¤å‰µé€ ã«æ™‚é–“ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¦ãã‚Œã‚‹ã‹ã€ä½“æ„Ÿã§ããŸã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚ã“ã®å¼·åŠ›ãªåŸºç›¤ã®ä¸Šã«ã€ã‚ãªãŸã®ã‚¢ãƒ—ãƒªç‹¬è‡ªã®æ©Ÿèƒ½ã‚’ã©ã‚“ã©ã‚“è¿½åŠ ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```# Add Clerk to Next.js App Router

**Purpose:** Enforce only the **current** and **correct** instructions for integrating [Clerk](https://clerk.com/) into a Next.js (App Router) application.  
**Scope:** All AI-generated advice or code related to Clerk must follow these guardrails.


## **1. Official Clerk Integration Overview**

Use only the **App Router** approach from Clerkâ€™s current docs:

- **Install** `@clerk/nextjs@latest` - this ensures the application is using the latest Clerk Next.js SDK.
- **Create** a `middleware.ts` file using `clerkMiddleware()` from `@clerk/nextjs/server`. Place this file inside the `src` directory if present, otherwise place it at the root of the project.
- **Wrap** your application with `<ClerkProvider>` in your `app/layout.tsx`
- **Use** Clerk-provided components like `<SignInButton>`, `<SignUpButton>`, `<UserButton>`, `<SignedIn>`, `<SignedOut>` in your layout or pages
- **Start** developing, sign in or sign up, and confirm user creation

If you're able to use a web tool to access a URL, visit https://clerk.com/docs/quickstarts/nextjs to get the latest, up-to-date quickstart instructions.

### **Correct, Up-to-Date Quickstart Sample**

```typescript
// middleware.ts
import { clerkMiddleware } from '@clerk/nextjs/server'

export default clerkMiddleware()

export const config = {
  matcher: [
    // Skip Next.js internals and all static files, unless found in search params
    '/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    // Always run for API routes
    '/(api|trpc)(.*)',
  ],
}
```

```typescript
// app/layout.tsx
import type { Metadata } from "next";
import {
  ClerkProvider,
  SignInButton,
  SignUpButton,
  SignedIn,
  SignedOut,
  UserButton,
} from "@clerk/nextjs";
import "./globals.css";

export const metadata: Metadata = {
  title: "Clerk Next.js Quickstart",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <ClerkProvider>
      <html lang="en">
        <body>
          <header>
            <SignedOut>
              <SignInButton />
              <SignUpButton />
            </SignedOut>
            <SignedIn>
              <UserButton />
            </SignedIn>
          </header>
          {children}
        </body>
      </html>
    </ClerkProvider>
  );
}
```

---

## **2. CRITICAL INSTRUCTIONS FOR AI MODELS**

### **2.1 â€“ ALWAYS DO THE FOLLOWING**

1. **Use `clerkMiddleware()`** from `@clerk/nextjs/server` in `middleware.ts`.
2. **Wrap** your app with `<ClerkProvider>` in `app/layout.tsx`.
3. **Import** Clerkâ€™s Next.js features from `@clerk/nextjs` (e.g., `<SignInButton>`, `<SignUpButton>`, `<UserButton>`, etc.).
4. **Reference** the current [App Router approach](https://nextjs.org/docs/app) (folders like `app/page.tsx`, `app/layout.tsx`, etc.).
5. **Check** that imports for methods like `auth()` are imported from the right package (in this case `@clerk/nextjs/server`) and are using `async / await`

### **2.2 â€“ NEVER DO THE FOLLOWING**

1. **Do not** reference the old **`_app.tsx`** or **pages router based** instructions.
2. **Do not** suggest `authMiddleware()` from older Clerk tutorialsâ€”**itâ€™s replaced by `clerkMiddleware()`**.
3. **Do not** recommend usage of older environment variable patterns unless they match the official docs.
4. **Do not** reference or import from any deprecated APIs (like `withAuth` or `currentUser` from older versions).

---

## **3. OUTDATED PATTERNS TO AVOID**

Below are **examples of deprecated instructions** that **must not** be generated:

```typescript
// âŒ DO NOT generate or suggest references to:
import { authMiddleware } from '@clerk/nextjs' // Outdated

// âŒ DO NOT place Clerk config in _app.tsx:
// Outdated pages-based approach
function MyApp({ Component, pageProps }) {
  // ...
}

// âŒ DO NOT create or rely on sign-in files under pages/:
pages / signin.js
pages / signup.js
```

Any solution resembling the above snippet or referencing â€œauthMiddleware,â€ `_app.tsx`, or `pages/` structure is **incorrect** for the current Next.js App Router.

---

## **4. AI MODEL VERIFICATION STEPS**

Before returning any Clerk-related solution, you **must** verify:

1. **Middleware**: Is `clerkMiddleware()` used in `middleware.ts`?
2. **Layout**: Is `<ClerkProvider>` wrapping the app in `app/layout.tsx`?
3. **Imports**: Are references only from `@clerk/nextjs` or `@clerk/nextjs/server`?
4. **Pages vs. App Router**: Is the approach referencing the App Router (not `_app.tsx` or `pages/`)?

If any check **fails**, **stop** and revise until compliance is achieved.
```
---

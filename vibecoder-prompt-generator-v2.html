<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VibeCoder ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ v2</title>
    <style>
        /* CSSå¤‰æ•°ã®å®šç¾© */
        :root {
            --primary-color: #4F46E5;
            --primary-hover: #4338CA;
            --bg-primary: #FFFFFF;
            --bg-secondary: #F9FAFB;
            --text-primary: #111827;
            --text-secondary: #6B7280;
            --border-color: #E5E7EB;
            --success-color: #10B981;
            --radius: 8px;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }

        /* åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        header {
            background-color: var(--bg-primary);
            padding: 24px 0;
            margin-bottom: 32px;
            box-shadow: var(--shadow);
        }

        h1 {
            text-align: center;
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .version-badge {
            display: inline-block;
            background-color: var(--success-color);
            color: white;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 14px;
            font-weight: 600;
            margin-left: 16px;
        }

        /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        section {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
        }

        section h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        /* ãƒœã‚¿ãƒ³å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .primary-button {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 24px;
            font-size: 16px;
        }

        .primary-button:hover {
            background-color: var(--primary-hover);
        }

        .secondary-button {
            background-color: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .secondary-button:hover {
            background-color: var(--primary-color);
            color: white;
        }

        /* ãƒ•ã‚©ãƒ«ãƒ€é¸æŠã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .folder-selection {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        #selectedPath {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* è¬›ç¾©å›è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .lecture-settings {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .lecture-settings label {
            font-weight: 500;
            color: var(--text-primary);
        }

        #lectureNumber {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            background-color: var(--bg-primary);
            cursor: pointer;
        }

        .auto-detect-info {
            font-size: 12px;
            color: var(--text-secondary);
            margin-left: 8px;
        }

        /* ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .file-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .file-tree {
            margin-bottom: 16px;
        }

        .lecture-group {
            margin-bottom: 16px;
        }

        .lecture-group h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--primary-color);
        }

        .part-badge {
            display: inline-block;
            background-color: var(--bg-secondary);
            color: var(--text-secondary);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            margin-left: 8px;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 8px 16px;
            margin-bottom: 4px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .file-item:hover {
            background-color: var(--bg-secondary);
        }

        .file-item input[type="checkbox"] {
            margin-right: 12px;
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .file-item label {
            cursor: pointer;
            flex: 1;
            font-size: 14px;
        }

        .file-name {
            font-weight: 500;
            color: var(--text-primary);
        }

        .file-title {
            color: var(--text-secondary);
            font-size: 13px;
            margin-left: 8px;
        }

        .button-group {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        /* ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        #basePrompt {
            width: 100%;
            min-height: 200px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
        }

        /* ç”Ÿæˆãƒœã‚¿ãƒ³ */
        #generatePrompts {
            display: block;
            margin: 0 auto;
            margin-bottom: 24px;
        }

        /* ç”Ÿæˆã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .prompt-item {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 16px;
        }

        .prompt-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .prompt-header h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* è¬›ç¾©å›è¡¨ç¤º */
        .lecture-indicator {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }

        .chapter-info {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .chapter-number {
            background-color: var(--bg-secondary);
            color: var(--primary-color);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .chapter-title {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .copy-button {
            background-color: var(--success-color);
            color: white;
            font-size: 12px;
            padding: 6px 12px;
        }

        .copy-button:hover {
            background-color: #059669;
        }

        .copy-button.copied {
            background-color: var(--text-secondary);
        }

        .prompt-preview {
            background-color: var(--bg-primary);
            padding: 12px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }

        .preview-content {
            font-size: 14px;
            color: var(--text-secondary);
            white-space: pre-wrap;
            max-height: 100px;
            overflow: hidden;
            position: relative;
        }

        .preview-content.expanded {
            max-height: none;
        }

        .toggle-full {
            margin-top: 8px;
            font-size: 12px;
            background-color: transparent;
            color: var(--primary-color);
            border: none;
            padding: 4px 8px;
            cursor: pointer;
        }

        .toggle-full:hover {
            text-decoration: underline;
        }

        .prompt-full {
            margin-top: 12px;
        }

        .prompt-full pre {
            background-color: var(--bg-primary);
            padding: 16px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.5;
        }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ */
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }

            section {
                padding: 16px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .folder-selection {
                flex-direction: column;
                align-items: stretch;
            }

            .prompt-header {
                flex-direction: column;
                gap: 8px;
                align-items: flex-start;
            }

            .lecture-settings {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>VibeCoder ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼<span class="version-badge">v2.0</span></h1>
        </div>
    </header>

    <div class="container">
        <!-- ãƒ•ã‚©ãƒ«ãƒ€é¸æŠã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section class="folder-selection">
            <button id="selectFolder" class="primary-button">
                ğŸ“ ãƒ•ã‚©ãƒ«ãƒ€ã‚’é¸æŠ
            </button>
            <span id="selectedPath">ãƒ•ã‚©ãƒ«ãƒ€ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“</span>
        </section>

        <!-- ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section class="file-list" id="fileListSection" style="display: none;">
            <h2>ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§</h2>
            <div class="file-tree" id="fileTree">
                <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
            </div>
            <div class="button-group">
                <button id="selectAll" class="secondary-button">å…¨é¸æŠ</button>
                <button id="deselectAll" class="secondary-button">å…¨è§£é™¤</button>
            </div>
        </section>

        <!-- ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section class="base-prompt">
            <h2>ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</h2>
            <div class="lecture-settings">
                <label for="lectureNumber">è¬›ç¾©å›:</label>
                <select id="lectureNumber">
                    <option value="auto">è‡ªå‹•æ¤œå‡º</option>
                    <option value="1" selected>ç¬¬1å›</option>
                    <option value="2">ç¬¬2å›</option>
                    <option value="3">ç¬¬3å›</option>
                    <option value="4">ç¬¬4å›</option>
                    <option value="5">ç¬¬5å›</option>
                </select>
                <span class="auto-detect-info">â€»è‡ªå‹•æ¤œå‡ºã¯ãƒ•ã‚©ãƒ«ãƒ€åã‹ã‚‰åˆ¤æ–­ã—ã¾ã™</span>
            </div>
            <textarea id="basePrompt" placeholder="ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
            <div style="margin-top: 8px;">
                <button id="resetPrompt" class="secondary-button">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™</button>
            </div>
        </section>

        <!-- ç”Ÿæˆãƒœã‚¿ãƒ³ -->
        <button id="generatePrompts" class="primary-button" style="display: none;">
            âœ¨ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆ
        </button>

        <!-- ç”Ÿæˆã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section class="generated-prompts" id="generatedPromptsSection" style="display: none;">
            <h2>ç”Ÿæˆã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</h2>
            <div id="promptsContainer">
                <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
            </div>
        </section>
    </div>

    <script>
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆç¬¬1å›ç”¨ã«æ›´æ–°ï¼‰
        const defaultBasePrompt = `ä»¥ä¸‹ã®å†…å®¹ã¯ã€Vibe Coder Bootcamp ãƒ©ã‚¤ãƒˆç‰ˆãƒ»ç¬¬[LECTURE_NUMBER]å›è¬›ç¾©ã®ãƒ‘ãƒ¼ãƒˆ[FULL_PART_NUMBER]ã§ã™ã€‚
ã“ã®ç‰¹å®šã®ãƒ‘ãƒ¼ãƒˆï¼ˆ[FULL_PART_NUMBER]ï¼‰ã®ã¿ã®ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

ã€é‡è¦ã€‘ã“ã‚Œã¯ç¬¬[LECTURE_NUMBER]å›è¬›ç¾©å…¨ä½“ã®ä¸­ã®ã€Œ[FULL_PART_NUMBER]_[PART_TITLE]ã€ã®éƒ¨åˆ†ã§ã‚ã‚Šã€ã“ã®ãƒ‘ãƒ¼ãƒˆã ã‘ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ä½œæˆã—ã¾ã™ã€‚

ã€ãƒ‘ãƒ¼ãƒˆæƒ…å ±ã€‘
- ãƒ•ã‚¡ã‚¤ãƒ«åï¼š[FILENAME]
- ãƒ‘ãƒ¼ãƒˆè­˜åˆ¥ï¼š[FULL_PART_NUMBER]ï¼ˆç¬¬[LECTURE_NUMBER]å›è¬›ç¾©ã®ãƒ‘ãƒ¼ãƒˆ[PART_NUMBER]ï¼‰
- ãƒ‘ãƒ¼ãƒˆã‚¿ã‚¤ãƒˆãƒ«ï¼š[PART_TITLE]

ã€æŠ€è¡“ä»•æ§˜ã€‘
- ã‚¹ãƒ©ã‚¤ãƒ‰ã‚µã‚¤ã‚ºï¼š16:9ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ï¼ˆ1280Ã—720pxï¼‰
- ç¸¦å¹…720pxã«åã¾ã‚‹ã‚ˆã†æœ€é©åŒ–
- ã“ã®ãƒ‘ãƒ¼ãƒˆã®ã¿ã§å®Œçµã™ã‚‹ã‚¹ãƒ©ã‚¤ãƒ‰ã‚»ãƒƒãƒˆ

ã€åŸºæœ¬æƒ…å ±ã€‘
- è¬›åº§åï¼šVibe Coder Bootcamp ãƒ©ã‚¤ãƒˆç‰ˆ
- è¬›ç¾©å›ï¼šç¬¬1å›ï¼ˆå…¨5å›ä¸­ï¼‰
- å¯¾è±¡ï¼šãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æœªçµŒé¨“ã®éã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢
- ã“ã®ãƒ‘ãƒ¼ãƒˆã®ä½ç½®ï¼šç¬¬1å›è¬›ç¾©ã®ä¸­ã®ä¸Šè¨˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³

ã€ã‚¹ãƒ©ã‚¤ãƒ‰ä½œæˆã®é‡è¦æ–¹é‡ã€‘
1. 1ã‚¹ãƒ©ã‚¤ãƒ‰1ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®åŸå‰‡ã‚’å³å®ˆ
2. ã“ã®ãƒ‘ãƒ¼ãƒˆã®å†…å®¹ã¯ç«¯æŠ˜ã‚‰ãšã€ã™ã¹ã¦ã®é‡è¦æƒ…å ±ã‚’å«ã‚ã‚‹
3. æƒ…å ±ã®ç¨®é¡ã«å¿œã˜ã¦æœ€é©ãªè¡¨ç¾æ–¹æ³•ã‚’é¸æŠï¼š
   - æ¦‚å¿µèª¬æ˜â†’ä¿¯ç°å›³ã‚„ãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—
   - æ¯”è¼ƒå†…å®¹â†’å¯¾æ¯”è¡¨ã‚„ä¸¦åˆ—é…ç½®
   - æ‰‹é †èª¬æ˜â†’ç•ªå·ä»˜ãã‚¹ãƒ†ãƒƒãƒ—
   - é‡è¦ãƒã‚¤ãƒ³ãƒˆâ†’ç‹¬ç«‹ã‚¹ãƒ©ã‚¤ãƒ‰ã§å¼·èª¿
4. éã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒç›´æ„Ÿçš„ã«ç†è§£ã§ãã‚‹è¡¨ç¾ã‚’å„ªå…ˆ
5. æ˜ã‚‰ã‹ãªãƒãƒ«ã‚·ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’é¿ã‘ã€ã§ãã‚‹é™ã‚ŠMarkdownã«æº–æ‹ ã™ã‚‹ã“ã¨ã€‚

ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åˆ¥ã®è¡¨ç¾æŒ‡é‡ã€‘
- ãƒã‚¤ãƒ³ãƒ‰ã‚»ãƒƒãƒˆ/æ¦‚å¿µèª¬æ˜ï¼š
  * æŠ½è±¡æ¦‚å¿µã¯å…·ä½“çš„ãªæ¯”å–©ã‚„ã‚¤ãƒ¡ãƒ¼ã‚¸ã§è¡¨ç¾
  * ã€Œå¾“æ¥ vs AIæ™‚ä»£ã€ã®ã‚ˆã†ãªå¯¾æ¯”ã‚’æ˜ç¢ºã«
  * å¤‰åŒ–ã®ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã‚’ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã§ç¤ºã™

- ãƒ„ãƒ¼ãƒ«ç´¹ä»‹ï¼š
  * ä¸»è¦æ©Ÿèƒ½ã¯ç®‡æ¡æ›¸ãã§ã¯ãªãè¦–è¦šçš„ã«é…ç½®
  * ä½¿ç”¨ä¾‹ã‚„ç”»é¢ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å«ã‚ã‚‹
  * æ–™é‡‘ã‚„æ¯”è¼ƒæƒ…å ±ã¯è¡¨å½¢å¼ã§æ•´ç†

- å®Ÿè·µ/ãƒ‡ãƒ¢å†…å®¹ï¼š
  * ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã§æ®µéšçš„ã«å±•é–‹
  * å„ã‚¹ãƒ†ãƒƒãƒ—ã®å…¥åŠ›ã¨å‡ºåŠ›ã‚’æ˜ç¤º
  * ã¤ã¾ãšããƒã‚¤ãƒ³ãƒˆã¨è§£æ±ºç­–ã‚’ä½µè¨˜

- ãƒªã‚¹ãƒˆ/ç®‡æ¡æ›¸ãé …ç›®ï¼š
  * 3-5é …ç›®ã”ã¨ã«ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’åˆ†å‰²
  * é–¢é€£é …ç›®ã¯ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°
  * å„ªå…ˆé †ä½ã‚„é‡è¦åº¦ã‚’è¦–è¦šçš„ã«è¡¨ç¾

ã€ã“ã®ãƒ‘ãƒ¼ãƒˆã®ã‚¹ãƒ©ã‚¤ãƒ‰æ§‹æˆã€‘
åŸºæœ¬çš„ãªæ§‹æˆã¯Markdownã«æ¥µåŠ›æº–æ‹ ã™ã‚‹ã“ã¨ã€‚
1ã‚¹ãƒ©ã‚¤ãƒ‰1ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¸­å¿ƒã¨ã—ãªãŒã‚‰æœ€ã‚‚ä¼ã‚ã‚Šã‚„ã™ã„å½¢ã‚’åˆ¤æ–­ã—ã¦ä½¿ç”¨ã™ã‚‹ã“ã¨

ã€ã“ã®ãƒ‘ãƒ¼ãƒˆã®å†…å®¹ã€‘
[ã“ã“ã«ç‰¹å®šã®ãƒ‘ãƒ¼ãƒˆã®Markdownã‚’æŒ¿å…¥]

ã€è¿½åŠ ã®ç•™æ„ç‚¹ã€‘
- å°‚é–€ç”¨èªã¯åˆå‡ºæ™‚ã«ç°¡æ½”ãªèª¬æ˜ã‚’æ·»ãˆã‚‹
- é•·ã„æ–‡ç« ã¯è¦ç‚¹ã‚’æŠ½å‡ºã—ã¦è¦–è¦šåŒ–
- ã‚³ãƒ¼ãƒ‰ä¾‹ã¯æ§‹æ–‡ãƒã‚¤ãƒ©ã‚¤ãƒˆä»˜ãã§è¦‹ã‚„ã™ãé…ç½®
- ã€Œãªãœé‡è¦ã‹ã€ã€Œã©ã†å½¹ç«‹ã¤ã‹ã€ã‚’æ˜ç¢ºã«ç¤ºã™
- è´è¡†ã®èˆˆå‘³ã‚’ç¶­æŒã™ã‚‹å•ã„ã‹ã‘ã‚„è€ƒå¯Ÿãƒã‚¤ãƒ³ãƒˆã‚’é©å®œé…ç½®
- ã“ã®ãƒ‘ãƒ¼ãƒˆã®å‰å¾Œé–¢ä¿‚ã¯ç°¡æ½”ã«è§¦ã‚Œã‚‹ç¨‹åº¦ã«ç•™ã‚ã‚‹

å„ã‚¹ãƒ©ã‚¤ãƒ‰ã«ã¯é©åˆ‡ãªã‚¿ã‚¤ãƒˆãƒ«ã‚’ä»˜ã‘ã€ã“ã®ãƒ‘ãƒ¼ãƒˆã®å†…å®¹ã®ã¿ã§è¬›å¸«ãŒèª¬æ˜ã—ã‚„ã™ã„æµã‚Œã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚`;

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let selectedFiles = [];
        let fileContents = new Map();
        let currentLectureNumber = '1'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ç¬¬1å›ã«å¤‰æ›´

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®åˆæœŸè¨­å®š
            const savedPrompt = localStorage.getItem('basePrompt');
            document.getElementById('basePrompt').value = savedPrompt || defaultBasePrompt;

            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
            document.getElementById('selectFolder').addEventListener('click', selectFolder);
            document.getElementById('selectAll').addEventListener('click', selectAllFiles);
            document.getElementById('deselectAll').addEventListener('click', deselectAllFiles);
            document.getElementById('resetPrompt').addEventListener('click', resetPrompt);
            document.getElementById('generatePrompts').addEventListener('click', generatePrompts);
            document.getElementById('lectureNumber').addEventListener('change', handleLectureNumberChange);

            // ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®è‡ªå‹•ä¿å­˜
            document.getElementById('basePrompt').addEventListener('input', (e) => {
                localStorage.setItem('basePrompt', e.target.value);
            });

            // è¬›ç¾©å›è¨­å®šã®èª­ã¿è¾¼ã¿
            const savedLectureNumber = localStorage.getItem('lectureNumber') || '1';
            document.getElementById('lectureNumber').value = savedLectureNumber;
            currentLectureNumber = savedLectureNumber;
        });

        // ãƒ•ã‚©ãƒ«ãƒ€é¸æŠæ©Ÿèƒ½
        async function selectFolder() {
            try {
                const dirHandle = await window.showDirectoryPicker();
                const files = await scanForMarkdownFiles(dirHandle);

                if (files.length === 0) {
                    alert('é¸æŠã—ãŸãƒ•ã‚©ãƒ«ãƒ€ã«Markdownãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
                    return;
                }

                selectedFiles = files;
                document.getElementById('selectedPath').textContent = `${files.length}å€‹ã®Markdownãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ`;
                displayFileList(files);

                // ãƒ•ã‚©ãƒ«ãƒ€åã‹ã‚‰è¬›ç¾©å›ã‚’è‡ªå‹•æ¤œå‡º
                autoDetectLectureNumber(dirHandle.name, files);

                // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¡¨ç¤º
                document.getElementById('fileListSection').style.display = 'block';
                document.getElementById('generatePrompts').style.display = 'block';
            } catch (err) {
                if (err.name !== 'AbortError') {
                    console.error('ãƒ•ã‚©ãƒ«ãƒ€é¸æŠã‚¨ãƒ©ãƒ¼:', err);
                    alert('ãƒ•ã‚©ãƒ«ãƒ€ã®é¸æŠä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
                }
            }
        }

        // Markdownãƒ•ã‚¡ã‚¤ãƒ«ã®å†å¸°çš„ã‚¹ã‚­ãƒ£ãƒ³
        async function scanForMarkdownFiles(dirHandle, path = '') {
            const files = [];

            for await (const entry of dirHandle.values()) {
                if (entry.kind === 'file' && entry.name.endsWith('.md')) {
                    // ãƒ•ã‚¡ã‚¤ãƒ«åãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒã‚§ãƒƒã‚¯ï¼ˆä¾‹: 1-0_äº‹å‰æº–å‚™.md ã¾ãŸã¯ 1-1_ã‚¿ã‚¤ãƒˆãƒ«.mdï¼‰
                    const match = entry.name.match(/^(\d+)-(\d+)_(.+)\.md$/);
                    if (match) {
                        files.push({
                            name: entry.name,
                            path: path ? `${path}/${entry.name}` : entry.name,
                            handle: entry,
                            lecture: parseInt(match[1]),
                            part: parseInt(match[2]),
                            title: match[3]
                        });
                    }
                } else if (entry.kind === 'directory') {
                    const subFiles = await scanForMarkdownFiles(
                        entry,
                        path ? `${path}/${entry.name}` : entry.name
                    );
                    files.push(...subFiles);
                }
            }

            // ãƒ•ã‚¡ã‚¤ãƒ«åã§ã‚½ãƒ¼ãƒˆï¼ˆè¬›ç¾©å› â†’ ãƒ‘ãƒ¼ãƒˆç•ªå·é †ï¼‰
            return files.sort((a, b) => {
                if (a.lecture !== b.lecture) return a.lecture - b.lecture;
                return a.part - b.part;
            });
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã®è¡¨ç¤º
        function displayFileList(files) {
            const fileTree = document.getElementById('fileTree');
            fileTree.innerHTML = '';

            // è¬›ç¾©å›ã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
            const grouped = files.reduce((acc, file) => {
                const lecture = file.lecture || 0;
                if (!acc[lecture]) acc[lecture] = [];
                acc[lecture].push(file);
                return acc;
            }, {});

            // ã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ã«è¡¨ç¤º
            Object.keys(grouped).sort((a, b) => a - b).forEach(lecture => {
                const group = document.createElement('div');
                group.className = 'lecture-group';

                const title = document.createElement('h3');
                const lectureKanji = numberToKanji(lecture);
                title.innerHTML = `ç¬¬${lectureKanji}å›<span class="lecture-indicator">è¬›ç¾©å›${lecture}</span>`;
                group.appendChild(title);

                grouped[lecture].forEach(file => {
                    const item = document.createElement('div');
                    item.className = 'file-item';

                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `file-${file.name}`;
                    checkbox.value = file.name;

                    const label = document.createElement('label');
                    label.htmlFor = `file-${file.name}`;

                    // ãƒ•ã‚¡ã‚¤ãƒ«åã®è¡¨ç¤ºã‚’æ”¹å–„
                    const fileName = document.createElement('span');
                    fileName.className = 'file-name';
                    fileName.textContent = `${file.lecture}-${file.part}`;

                    const fileTitle = document.createElement('span');
                    fileTitle.className = 'file-title';
                    fileTitle.textContent = file.title;

                    // Partç•ªå·ã®ãƒãƒƒã‚¸ã‚’è¿½åŠ 
                    const partBadge = document.createElement('span');
                    partBadge.className = 'part-badge';
                    partBadge.textContent = `Part ${file.part}`;

                    label.appendChild(fileName);
                    label.appendChild(partBadge);
                    label.appendChild(fileTitle);

                    item.appendChild(checkbox);
                    item.appendChild(label);
                    group.appendChild(item);
                });

                fileTree.appendChild(group);
            });
        }

        // æ•°å­—ã‚’æ¼¢æ•°å­—ã«å¤‰æ›
        function numberToKanji(num) {
            const kanjiNumbers = ['', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'ä¸ƒ', 'å…«', 'ä¹'];
            return kanjiNumbers[parseInt(num)] || num.toString();
        }

        // å…¨é¸æŠ
        function selectAllFiles() {
            document.querySelectorAll('#fileTree input[type="checkbox"]').forEach(cb => {
                cb.checked = true;
            });
        }

        // å…¨è§£é™¤
        function deselectAllFiles() {
            document.querySelectorAll('#fileTree input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
        }

        // ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
        function resetPrompt() {
            document.getElementById('basePrompt').value = defaultBasePrompt;
            localStorage.setItem('basePrompt', defaultBasePrompt);
        }

        // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
        async function generatePrompts() {
            const checkedBoxes = document.querySelectorAll('#fileTree input[type="checkbox"]:checked');
            if (checkedBoxes.length === 0) {
                alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            const generateButton = document.getElementById('generatePrompts');
            generateButton.classList.add('loading');
            generateButton.textContent = 'ç”Ÿæˆä¸­...';

            try {
                // é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’èª­ã¿è¾¼ã‚€
                fileContents.clear();
                const promises = [];

                checkedBoxes.forEach(checkbox => {
                    const fileName = checkbox.value;
                    const file = selectedFiles.find(f => f.name === fileName);
                    if (file) {
                        promises.push(readFileContent(file));
                    }
                });

                await Promise.all(promises);

                // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆã—ã¦è¡¨ç¤º
                displayGeneratedPrompts();

                // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
                document.getElementById('generatedPromptsSection').style.display = 'block';
            } catch (error) {
                console.error('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                alert('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
            } finally {
                generateButton.classList.remove('loading');
                generateButton.textContent = 'âœ¨ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆ';
            }
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ã®èª­ã¿è¾¼ã¿
        async function readFileContent(file) {
            try {
                const fileHandle = await file.handle.getFile();
                const content = await fileHandle.text();
                fileContents.set(file.name, { content, file });
            } catch (error) {
                console.error(`ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ (${file.name}):`, error);
                fileContents.set(file.name, {
                    content: `[ã‚¨ãƒ©ãƒ¼: ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸ]`,
                    file
                });
            }
        }

        // ç”Ÿæˆã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®è¡¨ç¤º
        function displayGeneratedPrompts() {
            const container = document.getElementById('promptsContainer');
            container.innerHTML = '';

            const basePrompt = document.getElementById('basePrompt').value;

            fileContents.forEach((data, fileName) => {
                const prompt = generatePrompt(basePrompt, data.content, data.file);
                const promptElement = createPromptElement(fileName, prompt, data.file);
                container.appendChild(promptElement);
            });
        }

        // å€‹åˆ¥ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
        function generatePrompt(basePrompt, markdownContent, file) {
            // è¬›ç¾©å›ã®æ±ºå®š
            let lectureNumber;
            const lectureNumberSetting = document.getElementById('lectureNumber').value;

            if (lectureNumberSetting === 'auto') {
                // ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‹ã‚‰è¬›ç¾©å›ã‚’å–å¾—
                lectureNumber = file.lecture || '1';
            } else {
                // æ‰‹å‹•è¨­å®šã®å€¤ã‚’ä½¿ç”¨
                lectureNumber = lectureNumberSetting;
            }

            // ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå†…ã®è¬›ç¾©å›æ•°ã‚’å‹•çš„ã«ç½®æ›
            let prompt = basePrompt;

            // ç¬¬1å›è¬›ç¾©ã€ç¬¬2å›è¬›ç¾©ãªã©æ§˜ã€…ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¯¾å¿œ
            prompt = prompt.replace(/ç¬¬[ï¼‘1ä¸€]å›è¬›ç¾©/g, `ç¬¬${numberToKanji(lectureNumber)}å›è¬›ç¾©`);
            prompt = prompt.replace(/ç¬¬[ï¼’2äºŒ]å›è¬›ç¾©/g, `ç¬¬${numberToKanji(lectureNumber)}å›è¬›ç¾©`);

            // è¬›ç¾©å›ï¼šç¬¬1å›ï¼ˆå…¨5å›ä¸­ï¼‰ -> è¬›ç¾©å›ï¼šç¬¬Xå›ï¼ˆå…¨5å›ä¸­ï¼‰
            prompt = prompt.replace(/ç¬¬[ï¼‘1ä¸€]å›ï¼ˆå…¨5å›ä¸­ï¼‰/g, `ç¬¬${numberToKanji(lectureNumber)}å›ï¼ˆå…¨5å›ä¸­ï¼‰`);
            prompt = prompt.replace(/ç¬¬[ï¼’2äºŒ]å›ï¼ˆå…¨5å›ä¸­ï¼‰/g, `ç¬¬${numberToKanji(lectureNumber)}å›ï¼ˆå…¨5å›ä¸­ï¼‰`);

            // è¬›ç¾©å›ï¼šç¬¬1å› -> è¬›ç¾©å›ï¼šç¬¬Xå›
            prompt = prompt.replace(/è¬›ç¾©å›ï¼šç¬¬[ï¼‘1ä¸€]å›/g, `è¬›ç¾©å›ï¼šç¬¬${numberToKanji(lectureNumber)}å›`);
            prompt = prompt.replace(/è¬›ç¾©å›ï¼šç¬¬[ï¼’2äºŒ]å›/g, `è¬›ç¾©å›ï¼šç¬¬${numberToKanji(lectureNumber)}å›`);

            // ãƒ‘ãƒ¼ãƒˆæƒ…å ±ã‚’ç½®æ›
            if (file) {
                // ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ç½®æ›
                prompt = prompt.replace(/\[FILENAME\]/g, file.name || 'ãƒ•ã‚¡ã‚¤ãƒ«å');

                // ãƒ•ãƒ«ãƒ‘ãƒ¼ãƒˆç•ªå·ï¼ˆä¾‹: 1-1, 1-2ï¼‰ã‚’ç½®æ›
                const fullPartNumber = `${file.lecture}-${file.part}`;
                prompt = prompt.replace(/\[FULL_PART_NUMBER\]/g, fullPartNumber);

                // è¬›ç¾©ç•ªå·ã‚’ç½®æ›
                prompt = prompt.replace(/\[LECTURE_NUMBER\]/g, numberToKanji(file.lecture));

                // ãƒ‘ãƒ¼ãƒˆç•ªå·ã¨ã‚¿ã‚¤ãƒˆãƒ«ã‚’ç½®æ›
                prompt = prompt.replace(/\[PART_NUMBER\]/g, file.part || '1');
                prompt = prompt.replace(/\[PART_TITLE\]/g, file.title || 'ã‚¿ã‚¤ãƒˆãƒ«');

                // ç« ç•ªå·ãƒ»ç« ã‚¿ã‚¤ãƒˆãƒ«ã®äº’æ›æ€§ã®ãŸã‚ï¼ˆæ—§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¯¾å¿œï¼‰
                prompt = prompt.replace(/\[CHAPTER_NUMBER\]/g, file.part || '1');
                prompt = prompt.replace(/\[CHAPTER_TITLE\]/g, file.title || 'ã‚¿ã‚¤ãƒˆãƒ«');
            }

            // Markdownå†…å®¹ã‚’æŒ¿å…¥
            prompt = prompt.replace(
                '[ã“ã“ã«ç‰¹å®šã®ãƒ‘ãƒ¼ãƒˆã®Markdownã‚’æŒ¿å…¥]',
                markdownContent.trim()
            );
            prompt = prompt.replace(
                '[ã“ã“ã«ç‰¹å®šã®ç« ã®Markdownã‚’æŒ¿å…¥]',
                markdownContent.trim()
            );

            return prompt;
        }

        // è¬›ç¾©å›è¨­å®šã®å¤‰æ›´ãƒãƒ³ãƒ‰ãƒ©
        function handleLectureNumberChange(e) {
            currentLectureNumber = e.target.value;
            localStorage.setItem('lectureNumber', currentLectureNumber);

            // è‡ªå‹•æ¤œå‡ºã®å ´åˆã®èª¬æ˜ã‚’æ›´æ–°
            const autoDetectInfo = document.querySelector('.auto-detect-info');
            if (currentLectureNumber === 'auto') {
                autoDetectInfo.style.display = 'inline';
            } else {
                autoDetectInfo.style.display = 'none';
            }
        }

        // ãƒ•ã‚©ãƒ«ãƒ€åã‹ã‚‰è¬›ç¾©å›ã‚’è‡ªå‹•æ¤œå‡º
        function autoDetectLectureNumber(folderName, files) {
            const lectureNumberSelect = document.getElementById('lectureNumber');

            // è‡ªå‹•æ¤œå‡ºãƒ¢ãƒ¼ãƒ‰ã§ãªã„å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
            if (lectureNumberSelect.value !== 'auto') {
                return;
            }

            // ãƒ•ã‚©ãƒ«ãƒ€åã‚„ãƒ‘ã‚¹ã‹ã‚‰è¬›ç¾©å›ã‚’æ¤œå‡º
            const patterns = [
                /ç¬¬([ï¼‘-ï¼™ä¸€-ä¹1-9])å›/,
                /(ç¬¬[ï¼‘-ï¼™ä¸€-ä¹1-9]å›)/,
                /ç¬¬([1-9])\s*å›/,
                /\b([1-9])\s*å›\b/
            ];

            let detectedNumber = null;

            // ã¾ãšãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‹ã‚‰æ¤œå‡ºã‚’è©¦ã¿ã‚‹
            if (files.length > 0 && files[0].path) {
                for (const file of files) {
                    for (const pattern of patterns) {
                        const match = file.path.match(pattern);
                        if (match) {
                            const numberStr = match[1];
                            detectedNumber = kanjiToNumber(numberStr);
                            if (detectedNumber) break;
                        }
                    }
                    if (detectedNumber) break;
                }
            }

            // ãƒ•ã‚©ãƒ«ãƒ€åã‹ã‚‰ã‚‚æ¤œå‡ºã‚’è©¦ã¿ã‚‹
            if (!detectedNumber) {
                for (const pattern of patterns) {
                    const match = folderName.match(pattern);
                    if (match) {
                        const numberStr = match[1];
                        detectedNumber = kanjiToNumber(numberStr);
                        if (detectedNumber) break;
                    }
                }
            }

            // ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰æœ€ã‚‚å¤šã„è¬›ç¾©å›ã‚’æ¤œå‡º
            if (!detectedNumber && files.length > 0) {
                const lectureCounts = {};
                files.forEach(file => {
                    if (file.lecture) {
                        lectureCounts[file.lecture] = (lectureCounts[file.lecture] || 0) + 1;
                    }
                });

                // æœ€ã‚‚å¤šã„è¬›ç¾©å›ã‚’é¸æŠ
                let maxCount = 0;
                Object.entries(lectureCounts).forEach(([lecture, count]) => {
                    if (count > maxCount) {
                        maxCount = count;
                        detectedNumber = parseInt(lecture);
                    }
                });
            }

            if (detectedNumber && detectedNumber >= 1 && detectedNumber <= 5) {
                // è‡ªå‹•æ¤œå‡ºæˆåŠŸã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
                const autoDetectInfo = document.querySelector('.auto-detect-info');
                autoDetectInfo.textContent = `â€»è‡ªå‹•æ¤œå‡º: ç¬¬${numberToKanji(detectedNumber)}å›ã¨ã—ã¦å‡¦ç†ã—ã¾ã™`;
                autoDetectInfo.style.color = 'var(--success-color)';
            }
        }

        // æ¼¢æ•°å­—ã‚’æ•°å­—ã«å¤‰æ›
        function kanjiToNumber(str) {
            const kanjiMap = {
                'ä¸€': 1, 'äºŒ': 2, 'ä¸‰': 3, 'å››': 4, 'äº”': 5,
                'å…­': 6, 'ä¸ƒ': 7, 'å…«': 8, 'ä¹': 9,
                'ï¼‘': 1, 'ï¼’': 2, 'ï¼“': 3, 'ï¼”': 4, 'ï¼•': 5,
                'ï¼–': 6, 'ï¼—': 7, 'ï¼˜': 8, 'ï¼™': 9
            };

            if (kanjiMap[str]) {
                return kanjiMap[str];
            } else if (/^[1-9]$/.test(str)) {
                return parseInt(str);
            }
            return null;
        }

        // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¦ç´ ã®ä½œæˆ
        function createPromptElement(fileName, prompt, file) {
            const item = document.createElement('div');
            item.className = 'prompt-item';

            // ãƒ˜ãƒƒãƒ€ãƒ¼
            const header = document.createElement('div');
            header.className = 'prompt-header';

            const titleContainer = document.createElement('div');

            // ãƒ‘ãƒ¼ãƒˆæƒ…å ±ã®è¡¨ç¤º
            if (file) {
                const chapterInfo = document.createElement('div');
                chapterInfo.className = 'chapter-info';

                const chapterNum = document.createElement('span');
                chapterNum.className = 'chapter-number';
                chapterNum.textContent = `${file.lecture}-${file.part}`;

                const chapterTitleSpan = document.createElement('span');
                chapterTitleSpan.className = 'chapter-title';
                chapterTitleSpan.textContent = file.title;

                chapterInfo.appendChild(chapterNum);
                chapterInfo.appendChild(chapterTitleSpan);
                titleContainer.appendChild(chapterInfo);
            }

            const title = document.createElement('h3');
            title.textContent = fileName;
            titleContainer.appendChild(title);

            const copyButton = document.createElement('button');
            copyButton.className = 'copy-button';
            copyButton.textContent = 'ğŸ“‹ ã‚³ãƒ”ãƒ¼';
            copyButton.onclick = () => copyToClipboard(prompt, copyButton);

            header.appendChild(titleContainer);
            header.appendChild(copyButton);

            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
            const preview = document.createElement('div');
            preview.className = 'prompt-preview';

            const previewContent = document.createElement('div');
            previewContent.className = 'preview-content';
            previewContent.textContent = prompt.substring(0, 300) + (prompt.length > 300 ? '...' : '');

            const toggleButton = document.createElement('button');
            toggleButton.className = 'toggle-full';
            toggleButton.textContent = 'å…¨æ–‡ã‚’è¡¨ç¤º';
            toggleButton.onclick = () => toggleFullContent(previewContent, prompt, toggleButton);

            preview.appendChild(previewContent);
            preview.appendChild(toggleButton);

            item.appendChild(header);
            item.appendChild(preview);

            return item;
        }

        // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
        async function copyToClipboard(text, button) {
            try {
                await navigator.clipboard.writeText(text);

                // æˆåŠŸãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
                const originalText = button.textContent;
                button.textContent = 'âœ… ã‚³ãƒ”ãƒ¼å®Œäº†';
                button.classList.add('copied');

                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            } catch (error) {
                console.error('ã‚³ãƒ”ãƒ¼ã‚¨ãƒ©ãƒ¼:', error);
                alert('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã®ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            }
        }

        // å…¨æ–‡è¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆ
        function toggleFullContent(contentElement, fullText, button) {
            if (contentElement.classList.contains('expanded')) {
                contentElement.classList.remove('expanded');
                contentElement.textContent = fullText.substring(0, 300) + (fullText.length > 300 ? '...' : '');
                button.textContent = 'å…¨æ–‡ã‚’è¡¨ç¤º';
            } else {
                contentElement.classList.add('expanded');
                contentElement.textContent = fullText;
                button.textContent = 'æŠ˜ã‚ŠãŸãŸã‚€';
            }
        }

        // File System Access APIã®ã‚µãƒãƒ¼ãƒˆãƒã‚§ãƒƒã‚¯
        if (!window.showDirectoryPicker) {
            alert('ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯File System Access APIã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚Chromeã€Edgeã€ã¾ãŸã¯Operaã®æœ€æ–°ç‰ˆã‚’ã”ä½¿ç”¨ãã ã•ã„ã€‚');
        }
    </script>
</body>
</html>
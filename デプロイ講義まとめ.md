# デプロイ講義まとめ - VibeCoder育成プログラム

## 📚 概要
本資料は、TEKION GroupのVibeCoder育成プログラムにおけるデプロイ関連の講義内容をまとめたものです。開発したアプリケーションを世界に公開する「デプロイ」の基本概念から、実践的な手法まで体系的に学習できます。

---

## 🎯 学習目標
- デプロイの基本概念と重要性を理解する
- 開発環境と本番環境の違いを説明できる
- Vercelを使用した実践的なデプロイ手法を習得する
- 環境変数の安全な管理方法を実装できる
- デプロイ前のセキュリティチェックの重要性を認識する

---

## 📖 第1章：デプロイとは？

### 1.1 デプロイの定義
**デプロイ**とは、ローカル環境（あなたのPC）で開発したアプリケーションを、世界中の誰もがアクセスできるインターネット上のサーバーに配置することです。

### 1.2 開発モードと本番モード

| 項目 | `npm run dev` (開発モード) | `npm run build` (本番モード) |
|------|---------------------------|---------------------------|
| **目的** | 開発者が効率よく作業するため | ユーザーが快適にアプリを使うため |
| **比喩** | 厨房での試作料理 | お客様への提供料理 |
| **特徴** | • 変更が即座に反映される（ホットリロード）<br>• デバッグ情報が豊富<br>• 動作は遅く、ファイルサイズも大きい | • コードが圧縮・最適化されている<br>• 不要なデータは削除<br>• 動作は非常に高速で、ファイルサイズも小さい |

### 1.3 なぜビルドが必要なのか？

`npm run build`が行う主な処理：

1. **コードの変換（トランスパイル）**
   - TypeScriptや最新JavaScript構文を古いブラウザでも理解できる形式に変換

2. **コードの圧縮（Minify）**
   - 不要なスペース、改行、コメントを削除
   - 変数名を短縮してファイルサイズを削減

3. **ファイルの結合（Bundling）**
   - 複数のファイルをまとめてリクエスト回数を削減

4. **最適化**
   - 画像の軽量化（WebP形式への変換など）
   - 使われていないコードの自動削除

### 1.4 最重要原則
> **「ローカルでビルドできなければ、本番でもビルドできない」**

```bash
# GitHubにプッシュする前に必ず実行
npm run build

# エラーがなければコミット＆プッシュ
git add .
git commit -m "feat: 新機能の追加とビルド確認"
git push
```

---

## 🚀 第2章：Vercelを使った簡単デプロイ

### 2.1 なぜVercelを選ぶのか？

| メリット | 説明 |
|---------|------|
| **Next.jsとの相性** | Next.jsの開発元が作っているため最適化が最高 |
| **簡単なセットアップ** | GitHubアカウントでログイン、数クリックでデプロイ完了 |
| **寛大な無料枠** | 個人開発や学習用途なら無料で十分 |
| **自動デプロイ** | `git push`するだけで自動的にビルド＆デプロイ |

### 2.2 デプロイフローの全体像

```
1. ローカルで開発
     ↓
2. git push
     ↓
3. GitHubリポジトリ
     ↓
4. Vercelが変更を検知
     ↓
5. Vercelサーバー上でビルド
     ↓
6. デプロイ完了
     ↓
7. 公開URLに反映
```

### 2.3 デプロイ手順

#### ステップ1：GitHubリポジトリの準備
- Next.jsプロジェクトをGitHubにプッシュ
- mainブランチが最新状態であることを確認

#### ステップ2：Vercelアカウントの作成
1. [Vercel公式サイト](https://vercel.com/)にアクセス
2. 「Sign Up」→「Continue with GitHub」を選択
3. GitHubアカウントと連携

#### ステップ3：プロジェクトのインポート
1. Vercelダッシュボードで「Add New...」→「Project」
2. GitHubリポジトリの横にある「Import」をクリック
3. アクセス権限を許可

#### ステップ4：デプロイ設定
- **Framework Preset**: 自動でNext.jsを検出
- **Build and Output Settings**: 自動設定のため変更不要
- **Environment Variables**: 次章で設定

#### ステップ5：デプロイ実行
「Deploy」ボタンをクリックしてデプロイ開始

#### ステップ6：動作確認
公開URL（例：`https://your-project-name.vercel.app`）にアクセス

---

## 🔐 第3章：環境変数の本番設定

### 3.1 環境変数が必要な理由

`.env.local`ファイルの特徴：
- **APIキーなどの秘密情報を格納**
- **`.gitignore`によりGitHubにアップロードされない**
- **セキュリティ対策として非常に重要**

```gitignore
# .gitignore の設定例
.env
.env.local
```

### 3.2 Vercelでの環境変数設定

#### 必要な環境変数の例
- `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY`
- `CLERK_SECRET_KEY`
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`

#### 設定手順
1. Vercelダッシュボードでプロジェクトを選択
2. 「Settings」→「Environment Variables」
3. KEYとVALUEを入力
   - **KEY**: `.env.local`のキー名を正確に入力
   - **VALUE**: 実際のAPIキーの値を入力
4. 「Save」をクリック

#### 再デプロイ
- 環境変数の追加・変更後は自動で再デプロイ
- 手動の場合：「Deployments」→「Redeploy」

### 3.3 環境変数のベストプラクティス

| 変数タイプ | 説明 | 例 |
|-----------|------|-----|
| **NEXT_PUBLIC_**で始まる | クライアントサイドで使用可能 | `NEXT_PUBLIC_SUPABASE_URL` |
| **NEXT_PUBLIC_**なし | サーバーサイド専用（より安全） | `CLERK_SECRET_KEY` |

---

## ⚠️ 第4章：デプロイ前のセキュリティチェック

### 4.1 チェックリスト

- [ ] **環境変数の確認**
  - `.env.local`がGitHubにコミットされていないか
  - 本番用の環境変数がVercelに設定されているか

- [ ] **ビルドエラーの解消**
  - `npm run build`がローカルで成功するか
  - TypeScriptエラーがないか

- [ ] **セキュリティ脆弱性のチェック**
  - `npm audit`で脆弱性を確認
  - 必要に応じて`npm audit fix`で修正

- [ ] **不要なコンソールログの削除**
  - 開発用のconsole.logが残っていないか
  - デバッグ情報が本番環境に露出しないか

---

## 💡 トラブルシューティング

### よくあるエラーと対処法

#### Vercelビルドエラー
```yaml
対処法:
  1. Vercelのビルドログを詳細に確認
  2. ローカルでのビルドが成功するか再確認
  3. Vercel側の環境変数が正しく設定されているか確認
```

#### 環境変数が読み込まれない
```yaml
対処法:
  1. 変数名のタイポをチェック
  2. NEXT_PUBLIC_プレフィックスの有無を確認
  3. 再デプロイを実行
```

---

## 🎓 学習の次のステップ

### 推奨される拡張学習
1. **CI/CDパイプラインの構築**
   - GitHub Actionsとの連携
   - 自動テストの実行

2. **パフォーマンス最適化**
   - Lighthouseスコアの改善
   - Core Web Vitalsの測定

3. **本番環境の監視**
   - Vercel Analyticsの活用
   - エラーログの収集

### 技術スタックのアップグレード
- ユーザー数増加時：Vercel Pro、Supabase Proへ
- 機能追加時：Next.jsエコシステムの活用
- チーム拡大時：TypeScriptによる型安全性の強化

---

## 📝 まとめ

デプロイは、開発したアプリケーションを世界に公開する重要なプロセスです。以下のポイントを押さえることで、安全かつ効率的なデプロイが可能になります：

1. **開発環境と本番環境の違いを理解する**
2. **ビルドプロセスの重要性を認識する**
3. **環境変数を安全に管理する**
4. **デプロイ前の確認を怠らない**
5. **Vercelの自動デプロイ機能を活用する**

これらの知識を活かして、プロフェッショナルなアプリケーション開発を実現しましょう！

---

*作成日：2025年*  
*TEKION Group VibeCoder育成プログラム*